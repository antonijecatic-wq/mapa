<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="icon" type="image/png" href="legend/profilna.png">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        /* Force popups and tooltips above all vector panes (use !important to override inline pane styles) */
        .leaflet-popup-pane, .leaflet-tooltip-pane {
            z-index: 2147483647 !important;
        }
        .leaflet-popup, .leaflet-popup-content-wrapper {
            z-index: 2147483647 !important;
        }
        /* Remove the popup close “x” button */
        .leaflet-container a.leaflet-popup-close-button {
            display: none !important;
        }
        /* Keep the legend/control from stretching full-width (so info text can wrap) */
        .leaflet-control-layers {
            max-width: 420px;
            box-sizing: border-box;
        }
        @media (max-width: 460px) {
            .leaflet-control-layers {
                max-width: calc(100vw - 30px);
            }
        }
        /* Make polygon fills pass pointer events through so underlying lines remain hoverable */
        .leaflet-overlay-pane path.poly-stroke-events {
            pointer-events: visibleStroke;
        }


        /* Also apply this behavior to the big polygon panes that otherwise block hovering points underneath */
        .pane_Podzonaproizvodnoindustrijskihaktivnosti_17 path.leaflet-interactive,
        .pane_Uticajnapovrinu_18 path.leaflet-interactive,
        .pane_Rudnotelo_19 path.leaflet-interactive,
        .pane_Podzonadeponije_20 path.leaflet-interactive,
        .pane_Podzonapristuparudniku_21 path.leaflet-interactive {
            pointer-events: visibleStroke;
        }
        /* Map title inside legend box */
        .legend-map-title {
            font-weight: bold;
            font-size: 20px;
            padding: 8px 5px;
            border-bottom: 2px solid #ddd;
            background: #f8f8f8;
            text-align: left;
            line-height: 1.25;
            display: flex;
            gap: 8px;
            align-items: flex-start;
            justify-content: space-between;
        }
        .legend-map-title.legend-info-open {
            border-bottom: 0;
        }
        .legend-map-title-text {
            flex: 1 1 auto;
            min-width: 0;
            white-space: pre-line;
        }
        .legend-info-toggle {
            flex: 0 0 auto;
            width: 22px;
            height: 22px;
            padding: 0;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-style: italic;
            font-size: 14px;
            line-height: 20px;
            text-align: center;
        }
        .legend-info-toggle:focus {
            outline: 2px solid #ddd;
            outline-offset: 2px;
        }
        .legend-info-panel {
            padding: 8px 10px;
            border-bottom: 2px solid #ddd;
            background: #f8f8f8;
            font-size: 13px;
            line-height: 1.35;
            white-space: normal;
            overflow-wrap: anywhere;
            word-break: break-word;
            font-style: italic;
        }
        .legend-layer-opacity {
            padding: 0 8px 0px 24px;
        }
        .legend-layer-opacity-row {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 6px;
            margin: 1px 0;
            font-size: 11px;
            line-height: 1.2;
        }
        .legend-layer-opacity-value {
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
        }
        .legend-layer-opacity input[type="range"] {
            width: 100%;
            height: 14px;
            margin: 0;
        }
        .legend-layer-opacity input[type="range"]::-webkit-slider-runnable-track {
            height: 2px;
        }
        .legend-layer-opacity input[type="range"]::-webkit-slider-thumb {
            height: 8px;
            width: 8px;
            margin-top: -6px;
        }
        .legend-layer-opacity input[type="range"]::-moz-range-track {
            height: 2px;
        }
        .legend-layer-opacity input[type="range"]::-moz-range-thumb {
            height: 12px;
            width: 12px;
        }
        .leaflet-marker-icon.sr-marker-hover-highlight {
            filter: drop-shadow(0 0 2px #ffff00) drop-shadow(0 0 6px #ffff00);
        }
        /* Infrastructure point hover: inspired by 'Zaštita kulturnih dobara' (orange/black emphasis) */
        .leaflet-marker-icon.sr-infra-marker-hover-highlight {
            transform: scale(1.6);
            transform-origin: center;
            filter: drop-shadow(0 0 1px rgba(0,0,0,1.0)) drop-shadow(0 0 4px rgba(253,83,0,1.0)) drop-shadow(0 0 8px rgba(253,83,0,1.0));
        }


        /* Legend title styling */
        .legend-title {
            font-weight: bold;
            font-size: 16px;
            padding: 8px 5px;
            margin-bottom: 10px;
            background: #f8f8f8;
        }
        /* Title is no longer a top bar; keep controls at default top */
        .leaflet-top.leaflet-right {
            top: 0;
        }
        .leaflet-top.leaflet-left {
            top: 0;
        }
        /* Logo styling */
        #map-logo {
            position: absolute;
            bottom: 25px;
            left: 15px;
            z-index: 1000;
            background: white;
            padding: 8px;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #map-logo a {
            display: block;
            line-height: 0;
        }
        #map-logo .map-logo-mars {
            height: 30px;
            width: auto;
        }
        #map-logo img {
            display: block;
            height: 20px;
            width: auto;
        }
        </style>
        <title>Sintezna mapa Prostornog plana za Jadar</title>
    </head>
    <body>
        <div id="map-logo">
            <a href="https://marssadrine.org/" target="_blank" rel="noopener noreferrer">
                <img class="map-logo-mars" src="images/mars-sa-drine.png" alt="Marš sa Drine">
            </a>
            <a href="https://www.rosalux.de/en/foundation/zid/europe/southeast-europe" target="_blank" rel="noopener noreferrer">
                <img src="images/Logo_horizontal_RGB.jpg" alt="Rosa Luxemburg Stiftung Southeast Europe">
            </a>
        </div>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet-svg-shape-markers.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="data/Katastarskeoptine_1.js"></script>
        <script src="data/Granicaplana_2.js"></script>
        <script src="data/Postojeestanjesaobraajneinfrastrukture_3.js"></script>
        <script src="data/Planiranostanjesaobraajneinfrastrukture_4.js"></script>
        <script src="data/Postojeestanjevodneinfrastrukture_5.js"></script>
        <script src="data/Planiranostanjevodneinfrastrukture_6.js"></script>
        <script src="data/Postojeestanjeelektroenergetskeinfrastukture_7.js"></script>
        <script src="data/Planiranostanjeelektroenergetskeinfrastukture_8.js"></script>
        <script src="data/Postojeestanjegasneinfrastrukture_9.js"></script>
        <script src="data/Planiranostanjegasneinfrastrukture_10.js"></script>
        <script src="data/Postojeestanjeelektroenergetskihobjekata_11.js"></script>
        <script src="data/Planiranostanjeelektroenergetskihobjekata_12.js"></script>
        <script src="data/Planiranostanjegasnihobjekata_13.js"></script>
        <script src="data/Postojeestanjevodneinfrastrukture_14.js"></script>
        <script src="data/Planiranostanjevodneinfrastrukture_15.js"></script>
        <script src="data/Pozajmitamaterijalaglina_16.js"></script>
        <script src="data/Podzonaproizvodnoindustrijskihaktivnosti_17.js"></script>
        <script src="data/Uticajnapovrinu_18.js"></script>
        <script src="data/Rudnotelo_19.js"></script>
        <script src="data/Podzonadeponije_20.js"></script>
        <script src="data/Podzonapristuparudniku_21.js"></script>
        <script src="data/Eksploatacionapolja_22.js"></script>
        <script src="data/Istraivanjepodzemnihvoda_23.js"></script>
        <script src="data/Aktivnaistranapolja_24.js"></script>
        <script src="data/Overenerezerve_25.js"></script>
        <script src="data/ZatitavodavodosnabdevanjaIIIstepen_26.js"></script>
        <script src="data/Zatitazemljitaoderozije_27.js"></script>
        <script src="data/Zatienaprirodnadobra_take_28.js"></script>
        <script src="data/EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29.js"></script>
        <script src="data/Podrujaupostupkuzatite_30.js"></script>
        <script src="data/Zatienaprirodnadobra_31.js"></script>
        <script src="data/Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32.js"></script>
        <script src="data/Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33.js"></script>
        <script src="data/Spomenikkultureodvelikogznaaja_34.js"></script>
        <script>
        var highlightLayer;

        var __markerHoverState = new WeakMap();
        var __vectorHoverState = new WeakMap();
        var __vectorHoverDomState = new WeakMap();
        var __activePointHoverLayer = null;

        // Infrastructure point layers (icons) should not use the custom hover styling/popup logic.
        // This keeps their design stable and avoids hover flicker.
        function __isInfrastructurePointLayer(layer) {
            try {
                var pane = layer && layer.options && layer.options.pane;
                return pane === 'pane_Postojeestanjeelektroenergetskihobjekata_11'
                    || pane === 'pane_Planiranostanjeelektroenergetskihobjekata_12'
                    || pane === 'pane_Planiranostanjegasnihobjekata_13'
                    || pane === 'pane_Postojeestanjevodneinfrastrukture_14'
                    || pane === 'pane_Planiranostanjevodneinfrastrukture_15';
            } catch (err) {
                return false;
            }
        }
        function __getLayerPopup(layer) {
            try {
                if (!layer) return null;
                if (typeof layer.getPopup === 'function') return layer.getPopup();
                return layer._popup || null;
            } catch (err) {
                return null;
            }
        }

        function __restoreVectorHover(layer) {
            try {
                var st = __vectorHoverState.get(layer);
                if (st && layer && typeof layer.setStyle === 'function') {
                    layer.setStyle(st);
                }
            } catch (err) {
                // ignore
            }
        }

        function __clearPointHover(layer) {
            try {
                if (!layer) return;
                __clearMarkerHoverHighlight(layer);
                __restoreVectorHover(layer);
            } catch (err) {
                // ignore
            }
        }

        function __clearActivePointHover() {
            try {
                if (__activePointHoverLayer) {
                    __clearPointHover(__activePointHoverLayer);
                }
            } catch (err) {
                // ignore
            } finally {
                __activePointHoverLayer = null;
            }
        }

        function __bindVectorPathMouseLeave(layer) {
            try {
                if (!layer || !layer._path || !layer._path.addEventListener) return;
                var meta = __vectorHoverDomState.get(layer);
                if (meta && meta.path === layer._path) return;
                layer._path.addEventListener('mouseleave', function() {
                    if (__activePointHoverLayer === layer) __activePointHoverLayer = null;
                    __clearPointHover(layer);
                }, { passive: true });
                __vectorHoverDomState.set(layer, { path: layer._path });
            } catch (err) {
                // ignore
            }
        }

        function __setActivePointHover(layer) {
            if (__activePointHoverLayer && __activePointHoverLayer !== layer) {
                __clearPointHover(__activePointHoverLayer);
            }
            __activePointHoverLayer = layer;
        }

        function __applyMarkerHoverHighlight(layer) {
            __applyMarkerHoverClass(layer, 'sr-marker-hover-highlight');
        }

        function __applyMarkerHoverClass(layer, className) {
            try {
                if (!layer || typeof layer.setZIndexOffset !== 'function') return;
                var state = __markerHoverState.get(layer);
                if (!state) {
                    state = {
                        zIndexOffset: (typeof layer.options.zIndexOffset === 'number') ? layer.options.zIndexOffset : 0,
                        icon: null,
                        bound: false,
                        cls: null
                    };
                    __markerHoverState.set(layer, state);
                }
                state.cls = className;
                layer.setZIndexOffset(1000);
                if (layer._icon && layer._icon.classList && className) {
                    layer._icon.classList.add(className);
                }

                // Fallback: bind native mouseleave on the icon so the highlight always clears
                if (layer._icon && layer._icon.addEventListener) {
                    if (state.icon !== layer._icon) {
                        state.icon = layer._icon;
                        state.bound = false;
                    }
                    if (!state.bound) {
                        state.bound = true;
                        layer._icon.addEventListener('mouseleave', function() {
                            __clearPointHover(layer);
                        }, { passive: true });
                    }
                }
            } catch (err) {
                // ignore
            }
        }

        function __applyInfrastructureMarkerHoverHighlight(layer) {
            __applyMarkerHoverClass(layer, 'sr-infra-marker-hover-highlight');
        }

        function __clearMarkerHoverHighlight(layer) {
            try {
                if (!layer) return;
                var state = __markerHoverState.get(layer);
                if (state && typeof layer.setZIndexOffset === 'function') {
                    layer.setZIndexOffset(state.zIndexOffset || 0);
                }
                if (layer._icon && layer._icon.classList) {
                    layer._icon.classList.remove('sr-marker-hover-highlight');
                    layer._icon.classList.remove('sr-infra-marker-hover-highlight');
                    if (state && state.cls) {
                        layer._icon.classList.remove(state.cls);
                    }
                }
            } catch (err) {
                // ignore
            }
        }

        function highlightFeature(e) {
            highlightLayer = e.target;

            // Reset: keep infrastructure point icon design stable (no hover highlight, no hover popup).
            if (__isInfrastructurePointLayer(highlightLayer)) {
                return;
            }

            // Preserve current opacity settings so hover highlighting never resets transparency
            var _curOpacity = (highlightLayer && highlightLayer.options && typeof highlightLayer.options.opacity === 'number') ? highlightLayer.options.opacity : undefined;
            var _curFillOpacity = (highlightLayer && highlightLayer.options && typeof highlightLayer.options.fillOpacity === 'number') ? highlightLayer.options.fillOpacity : undefined;
            var _curFillColor = (highlightLayer && highlightLayer.options && highlightLayer.options.fillColor) ? highlightLayer.options.fillColor : undefined;

            var geomType = e.target.feature && e.target.feature.geometry && e.target.feature.geometry.type;

            // Some point layers (notably icon markers created via pointToLayer) may not expose feature geometry
            // consistently during events; infer a reasonable geometry type from the layer instance.
            var _isMarker = (highlightLayer && typeof highlightLayer.getLatLng === 'function' && typeof highlightLayer.setStyle !== 'function');
            var _isStyledPoint = (highlightLayer && typeof highlightLayer.getLatLng === 'function' && typeof highlightLayer.setStyle === 'function' && typeof highlightLayer.getLatLngs !== 'function');
            var _isLineOrPoly = (highlightLayer && typeof highlightLayer.getLatLngs === 'function' && typeof highlightLayer.setStyle === 'function');
            var _treatAsPolygon = false;
            if (!geomType) {
                if (_isMarker || _isStyledPoint) {
                    geomType = 'Point';
                } else if (_isLineOrPoly) {
                    // If the layer is fill-capable, treat it as polygon; otherwise as line.
                    _treatAsPolygon = !!(highlightLayer.options && (highlightLayer.options.fill === true || typeof highlightLayer.options.fillOpacity === 'number'));
                    geomType = _treatAsPolygon ? 'Polygon' : 'LineString';
                }
            }

            // Always clear any marker glow / restore pane zIndex on mouseout.
            // This must be registered outside of the pane-promotion try/catch so it cannot be skipped.
            var _didPromotePane = false;
            if (typeof highlightLayer.once === 'function') {
                highlightLayer.once('mouseout', function(ev) {
                    try {
                        if (_didPromotePane) restoreLayerPaneZIndex(ev.target);
                    } catch (err) {}
                    __clearPointHover(ev.target);
                    // close hover popup shown at cursor
                    if (_legendPopup) {
                        try { map.closePopup(_legendPopup); } catch (err) {}
                        _legendPopup = null;
                    }
                    if (__activePointHoverLayer === ev.target) {
                        __activePointHoverLayer = null;
                    }
                });
            }

            // Infrastructure points: use orange/black icon emphasis (like cultural heritage points)
            // and skip the hover popup-at-cursor logic (prevents flicker).
            if (__isInfrastructurePointLayer(highlightLayer)) {
                __setActivePointHover(highlightLayer);
                __applyInfrastructureMarkerHoverHighlight(highlightLayer);
                return;
            }
            
                        if (geomType === 'Point' || geomType === 'MultiPoint') {
                // points: apply a visible highlight (CircleMarker via setStyle; icon markers via CSS glow)
                __setActivePointHover(highlightLayer);
                if (typeof highlightLayer.setStyle === 'function') {
                    if (!__vectorHoverState.has(highlightLayer)) {
                        __vectorHoverState.set(highlightLayer, {
                            color: highlightLayer.options && highlightLayer.options.color,
                            weight: highlightLayer.options && highlightLayer.options.weight,
                            opacity: highlightLayer.options && highlightLayer.options.opacity,
                            fillOpacity: highlightLayer.options && highlightLayer.options.fillOpacity,
                            fillColor: highlightLayer.options && highlightLayer.options.fillColor
                        });
                    }
                    var pointStyle = { color: '#ffff00', weight: 3 };
                    if (typeof _curOpacity === 'number') pointStyle.opacity = _curOpacity;
                    if (typeof _curFillOpacity === 'number') pointStyle.fillOpacity = _curFillOpacity;
                    if (_curFillColor) pointStyle.fillColor = _curFillColor;
                    highlightLayer.setStyle(pointStyle);
                    __bindVectorPathMouseLeave(highlightLayer);
                } else {
                    __applyMarkerHoverHighlight(highlightLayer);
                }
            } else if (geomType === 'LineString' || geomType === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
                                weight: 3,
                                opacity: _curOpacity
              });
            } else {
              // polygons: emphasize outline but keep existing fill
              highlightLayer.setStyle({
                color: '#ffff00',
                                weight: 3,
                                opacity: _curOpacity,
                                fillOpacity: _curFillOpacity,
                                fillColor: _curFillColor
              });
            }

            // Bring the feature to the front.
            // For points/markers, avoid promoting the whole pane (it can make other point layers look different).
            try {
                if (!_isMarker && !_isStyledPoint) {
                    bringLayerPaneToFront(highlightLayer);
                    _didPromotePane = true;
                }
                if (typeof highlightLayer.bringToFront === 'function') {
                    highlightLayer.bringToFront();
                }
            } catch (err) {
                // ignore
            }

            // Show hover text at the cursor (not at the feature center)
            try {
                // close any existing hover popup
                if (_legendPopup) {
                    try { map.closePopup(_legendPopup); } catch (err) {}
                    _legendPopup = null;
                }

                // Prefer the feature's own popup content if it exists and is non-empty
                var popup = __getLayerPopup(highlightLayer);
                var popupContent = null;
                if (popup) {
                    try {
                        popupContent = (typeof popup.getContent === 'function') ? popup.getContent() : popup._content;
                    } catch (err) {
                        popupContent = popup._content;
                    }
                }
                var hasPopup = popupContent && contentHasData(popupContent);

                // Otherwise fall back to legend label text
                var lbl = null;
                if (!hasPopup) {
                    lbl = _legendLabelsById && _legendLabelsById[highlightLayer._leaflet_id];
                    if (!lbl && highlightLayer._eventParents) {
                        for (var pid in highlightLayer._eventParents) {
                            try {
                                var parent = highlightLayer._eventParents[pid];
                                if (parent && parent._leaflet_id && _legendLabelsById[parent._leaflet_id]) {
                                    lbl = _legendLabelsById[parent._leaflet_id];
                                    break;
                                }
                            } catch (err) {
                                // ignore
                            }
                        }
                    }
                }

                var contentToShow = hasPopup ? popupContent : lbl;
                var popupLatLng = _lastMouseLatLng || (e && e.latlng) || (highlightLayer.getLatLng && highlightLayer.getLatLng()) || (typeof highlightLayer.getBounds === 'function' ? highlightLayer.getBounds().getCenter() : null);
                if (contentToShow && popupLatLng) {
                    _legendPopup = L.popup({
                        offset: [0, -10],
                        autoPan: false,
                        keepInView: false,
                        closeButton: false,
                        closeOnClick: false
                    }).setLatLng(popupLatLng).setContent(contentToShow).openOn(map);
                }
            } catch (err) {
                // ignore
            }
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28,
            zoomSnap: 0.25,
            zoomDelta: 0.25,
        }).fitBounds([[44.348543329318254,19.152465294812583],[44.65733310776722,19.679019910261875]], {
            padding: [30, 30],
            animate: false
        });
        map.setZoom(map.getZoom() + 0.5);

        // Keep point markers above very-high zIndex polygon panes (some polygons use zIndex=999).
        // This prevents points from being visually covered and from losing hover/click interaction.
        try {
            if (map.getPane && map.getPane('shadowPane')) {
                map.getPane('shadowPane').style.zIndex = 1999;
            }
            if (map.getPane && map.getPane('markerPane')) {
                map.getPane('markerPane').style.zIndex = 2000;
            }
        } catch (e) {
            // ignore
        }

        // Fail-safe: clear any stuck point hover highlight when the pointer is no longer on the point.
        // This covers cases where Leaflet doesn't emit 'mouseout' (fast moves, popup overlap, SVG/canvas quirks).
        if (!window._srPointHoverClearBound) {
            window._srPointHoverClearBound = true;
            map.on('mousemove', function(ev) {
                try {
                    if (!__activePointHoverLayer) return;
                    var layer = __activePointHoverLayer;
                    var t = ev && ev.originalEvent && ev.originalEvent.target;
                    var icon = layer && layer._icon;
                    var path = layer && layer._path;

                    // Still over the same point -> keep highlight
                    if (t && (t === icon || (icon && icon.contains && icon.contains(t)) || t === path)) return;

                    // Otherwise clear the point hover
                    __clearActivePointHover();
                } catch (err) {
                    // ignore
                }
            });
            map.on('zoomstart', __clearActivePointHover);
            map.on('movestart', __clearActivePointHover);
            map.on('dragstart', __clearActivePointHover);
        }
        // Per-layer opacity values (0..1) used by style functions and legend sliders
        var __layerOpacity = {
            Podzonaproizvodnoindustrijskihaktivnosti_17: 0.5,
            Uticajnapovrinu_18: 0.5,
            Rudnotelo_19: 0.5,
            Podzonapristuparudniku_21: 0.5,
            Podzonadeponije_20: 0.5
        };
        function __getLayerOpacity(key, fallback) {
            try {
                var v = __layerOpacity && __layerOpacity[key];
                return (typeof v === 'number' && isFinite(v)) ? v : fallback;
            } catch (e) {
                return fallback;
            }
        }

        // Re-apply the current (slider-driven) styles after any resetStyle() calls
        function __applyAllOpacityStyles() {
            try {
                if (typeof layer_Podzonaproizvodnoindustrijskihaktivnosti_17 !== 'undefined' && typeof style_Podzonaproizvodnoindustrijskihaktivnosti_17_0 !== 'undefined') {
                    layer_Podzonaproizvodnoindustrijskihaktivnosti_17.setStyle(style_Podzonaproizvodnoindustrijskihaktivnosti_17_0);
                }
                if (typeof layer_Uticajnapovrinu_18 !== 'undefined' && typeof style_Uticajnapovrinu_18_0 !== 'undefined') {
                    layer_Uticajnapovrinu_18.setStyle(style_Uticajnapovrinu_18_0);
                }
                if (typeof layer_Rudnotelo_19 !== 'undefined' && typeof style_Rudnotelo_19_0 !== 'undefined') {
                    layer_Rudnotelo_19.setStyle(style_Rudnotelo_19_0);
                }
                if (typeof layer_Podzonadeponije_20 !== 'undefined' && typeof style_Podzonadeponije_20_0 !== 'undefined') {
                    layer_Podzonadeponije_20.setStyle(style_Podzonadeponije_20_0);
                }
                if (typeof layer_Podzonapristuparudniku_21 !== 'undefined' && typeof style_Podzonapristuparudniku_21_0 !== 'undefined') {
                    layer_Podzonapristuparudniku_21.setStyle(style_Podzonapristuparudniku_21_0);
                }
            } catch (e) {
                // ignore
            }
        }
        // var hash = new L.Hash(map);
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }

		// Return true if popup content contains visible text or media
		function contentHasData(content) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('img')) {
				return true;
			}
			return tempDiv.textContent.trim().length > 0;
		}

		// Bring a layer's pane to the front (temporarily) so it doesn't get hidden by larger polygons
		function bringLayerPaneToFront(layer) {
			try {
				var paneName = layer && layer.options && layer.options.pane;
				if (!paneName) return;
				var pane = map.getPane(paneName);
				if (layer._origPaneZIndex !== undefined) return;
				layer._origPaneZIndex = pane.style.zIndex || '';
				var panes = document.querySelectorAll('.leaflet-pane');
				var max = 0;
				for (var i = 0; i < panes.length; i++) {
					var z = parseInt(panes[i].style.zIndex, 10);
					if (!isNaN(z) && z > max) max = z;
				}
				pane.style.zIndex = (max + 1).toString();
			} catch (err) {
				// ignore
			}
		}

		// Restore the pane zIndex if we changed it
		function restoreLayerPaneZIndex(layer) {
			try {
				var paneName = layer && layer.options && layer.options.pane;
				if (!paneName) return;
				var pane = map.getPane(paneName);
				if (!pane) return;
				if (layer._origPaneZIndex === undefined) return;
				pane.style.zIndex = layer._origPaneZIndex;
				delete layer._origPaneZIndex;
			} catch (err) {
				// ignore
			}
		}

		// Prevent binding empty popups globally
		(function(){
			var originalBindPopup = L.Layer.prototype.bindPopup;
			L.Layer.prototype.bindPopup = function(content, options) {
				try {
					if (!contentHasData(content)) {
						return this; // skip binding empty content
					}
				} catch (err) {
					// if anything goes wrong, fall back to original
					return originalBindPopup.call(this, content, options);
				}
				return originalBindPopup.call(this, content, options);
			};
		})();

		// Build mapping from SVG path elements to their Leaflet layer object (also map marker icons/shadows)
		function buildPathToLayerMap() {
			for (var id in map._layers) {
				var layer = map._layers[id];
				try {
					if (layer && layer._path) {
						layer._path._leaflet_layer = layer;
					}
					// Also map marker icon and shadow DOM elements to layer so elementsFromPoint can find them
					if (layer && layer._icon) {
						layer._icon._leaflet_layer = layer;
					}
					if (layer && layer._shadow) {
						layer._shadow._leaflet_layer = layer;
					}
				} catch (err) {
					// ignore
				}
			}
		} 

		// Estimate bounds area for heuristic: smaller area -> more likely 'small' polygon
		function estimateLayerArea(layer) {
			try {
				if (!layer.getBounds) return Infinity;
				var b = layer.getBounds();
				var latDiff = Math.abs(b.getNorth() - b.getSouth());
				var lngDiff = Math.abs(b.getEast() - b.getWest());
				return latDiff * lngDiff;
			} catch (err) {
				return Infinity;
			}
		}

		var _simulatedHoverLayer = null;
		var _hitTestTimer = null;
		var _lastMouseLatLng = null; // updated on mousemove for fallback popups
		var _legendPopup = null; // temporary popup for legend text
		var _legendLabelsById = {}; // mapping from layer._leaflet_id to legend text (plain)

		function clearSimulatedHover() {
			if (!_simulatedHoverLayer) return;
			try {
				var layer = _simulatedHoverLayer;
                var gtype = layer && layer.feature && layer.feature.geometry && layer.feature.geometry.type;
                var isPointLayer = (gtype === 'Point' || gtype === 'MultiPoint') || (typeof L !== 'undefined' && L.CircleMarker && layer instanceof L.CircleMarker) || !!layer._icon;
                if (isPointLayer) {
                    // GeoJSON.resetStyle on CircleMarkers can revert to Leaflet defaults (blue).
                    // Restore the marker's original style if we captured it.
                    if (layer && layer.setStyle && layer._qgis2web_originalStyle) {
                        layer.setStyle(layer._qgis2web_originalStyle);
                    }
                } else {
                    for (var i in layer._eventParents) {
                        if (typeof layer._eventParents[i].resetStyle === 'function') {
                            layer._eventParents[i].resetStyle(layer);
                        }
                    }
                }
				if (typeof layer.closePopup == 'function') {
					layer.closePopup();
				} else if (layer.eachLayer) {
					layer.eachLayer(function(f) { f.closePopup(); });
				}
			} catch (err) {
				// ignore
			}
			_simulatedHoverLayer = null;
			// close any legend popup
			if (_legendPopup) {
				try { map.closePopup(_legendPopup); } catch (err) {}
				_legendPopup = null;
			}
		}

		function simulateHoverAtEvent(e) {
			// Build map from DOM path elements to layers if not present
			buildPathToLayerMap();

			var ev = e && e.originalEvent ? e.originalEvent : e;
			if (!ev || typeof document.elementsFromPoint !== 'function') return;

			var els = document.elementsFromPoint(ev.clientX, ev.clientY);
			var seen = {};
			var layers = [];
			for (var i = 0; i < els.length; i++) {
				var el = els[i];
				if (el && el._leaflet_layer && !seen[el._leaflet_layer._leaflet_id]) {
					seen[el._leaflet_layer._leaflet_id] = true;
					layers.push(el._leaflet_layer);
				}
			}

            // Also detect nearby point markers (even when occluded by polygons)
			try {
				var mouseLatLng = _lastMouseLatLng || (e && e.latlng);
				if (mouseLatLng) {
					var mousePt = map.latLngToContainerPoint(mouseLatLng);
					var nearby = [];
					for (var id in map._layers) {
						var layer = map._layers[id];
						try {
							var gtype = layer.feature && layer.feature.geometry && layer.feature.geometry.type;
							var isPoint = (gtype === 'Point' || gtype === 'MultiPoint') || (typeof L !== 'undefined' && L.Marker && layer instanceof L.Marker) || layer._icon || (typeof L !== 'undefined' && L.CircleMarker && layer instanceof L.CircleMarker);
							if (!isPoint) continue;
							var latlng = (layer.getLatLng && layer.getLatLng()) || layer._latlng;
							if (!latlng) continue;
							var p = map.latLngToContainerPoint(latlng);
							var dx = p.x - mousePt.x, dy = p.y - mousePt.y;
							var d = Math.sqrt(dx*dx + dy*dy);
							// threshold in pixels
							if (d <= 12) nearby.push({d: d, layer: layer});
						} catch (err) {
							// ignore
						}
					}
					if (nearby.length) {
						nearby.sort(function(a,b){ return a.d - b.d; });
						// prepend nearby markers (closest first) if not already present
						for (var k = nearby.length - 1; k >= 0; k--) {
							var lay = nearby[k].layer;
							if (!seen[lay._leaflet_id]) {
								seen[lay._leaflet_id] = true;
								layers.unshift(lay);
							}
						}
					}
                    // Detect nearby line features (even when occluded by polygons)
                    function pointToSegmentDistance(p, v, w) {
                        var l2 = Math.pow(v.x - w.x, 2) + Math.pow(v.y - w.y, 2);
                        if (l2 === 0) return Math.sqrt(Math.pow(p.x - v.x, 2) + Math.pow(p.y - v.y, 2));
                        var t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;
                        t = Math.max(0, Math.min(1, t));
                        var proj = { x: v.x + t * (w.x - v.x), y: v.y + t * (w.y - v.y) };
                        return Math.sqrt(Math.pow(p.x - proj.x, 2) + Math.pow(p.y - proj.y, 2));
                    }
                    var nearestLine = null;
                    for (var id2 in map._layers) {
                        var lyr = map._layers[id2];
                        try {
                            var gt = lyr.feature && lyr.feature.geometry && lyr.feature.geometry.type;
                            if (!(gt === 'LineString' || gt === 'MultiLineString')) continue;
                            var latlngs = lyr.getLatLngs ? lyr.getLatLngs() : null;
                            if (!latlngs) continue;
                            // Flatten latlngs array
                            var flat = [];
                            (function flatten(a){ for (var i=0;i<a.length;i++){ var v=a[i]; if (Array.isArray(v)) flatten(v); else flat.push(v); } })(latlngs);
                            if (flat.length < 2) continue;
                            var minD = Infinity;
                            var prev = null;
                            for (var i2=0;i2<flat.length;i2++) {
                                var cp = map.latLngToContainerPoint(flat[i2]);
                                if (prev) {
                                    var d2 = pointToSegmentDistance(mousePt, prev, cp);
                                    if (d2 < minD) minD = d2;
                                }
                                prev = cp;
                            }
                            if (minD <= 12) {
                                if (!nearestLine || minD < nearestLine.d) nearestLine = { d: minD, layer: lyr };
                            }
                        } catch (err) { /* ignore */ }
                    }
                    if (nearestLine && !seen[nearestLine.layer._leaflet_id]) {
                        seen[nearestLine.layer._leaflet_id] = true;
                        layers.unshift(nearestLine.layer);
                    }
				}
			} catch (err) {
				// ignore
			}

			if (layers.length === 0) {
				clearSimulatedHover();
				return;
			}

			// Decide between point and polygon by DOM stacking order:
			// if a point/marker appears above polygons, pick it; if a polygon is above, pick that polygon.
            var firstPointIdx = -1;
            var firstPolygonIdx = -1;
            var firstLineIdx = -1;
			for (var j = 0; j < layers.length; j++) {
				var lay = layers[j];
				var gtype = lay.feature && lay.feature.geometry && lay.feature.geometry.type;
				var isMarker = (!gtype && (typeof L !== 'undefined' && L.Marker && lay instanceof L.Marker || lay._icon));
				if ((gtype === 'Point' || gtype === 'MultiPoint' || isMarker) && firstPointIdx === -1) firstPointIdx = j;
				if ((gtype === 'Polygon' || gtype === 'MultiPolygon') && firstPolygonIdx === -1) firstPolygonIdx = j;
                if ((gtype === 'LineString' || gtype === 'MultiLineString') && firstLineIdx === -1) firstLineIdx = j;
			}

			var candidate = null;
            if (firstPointIdx !== -1 && (firstPolygonIdx === -1 || firstPointIdx < firstPolygonIdx) && (firstLineIdx === -1 || firstPointIdx < firstLineIdx)) {
                candidate = layers[firstPointIdx];
            } else if (firstLineIdx !== -1 && (firstPolygonIdx === -1 || firstLineIdx < firstPolygonIdx)) {
                candidate = layers[firstLineIdx];
            } else if (firstPolygonIdx !== -1) {
				// pick smallest polygon (heuristic) among polygons
				var bestArea = Infinity;
				for (var j = 0; j < layers.length; j++) {
					var lay = layers[j];
					if (!lay.feature || !lay.feature.geometry) continue;
					var gtype = lay.feature.geometry.type;
					if (gtype === 'Polygon' || gtype === 'MultiPolygon') {
						var a = estimateLayerArea(lay);
						if (a < bestArea) { bestArea = a; candidate = lay; }
					}
				}
			} else {
				candidate = layers[0];
			}

			if (candidate === _simulatedHoverLayer) return; // unchanged

			clearSimulatedHover();
            // Do not simulate hover for infrastructure point icon layers (keeps their design stable).
            if (__isInfrastructurePointLayer(candidate)) return;
			// trigger highlight on candidate
			try {
				highlightFeature({ target: candidate });
				_simulatedHoverLayer = candidate;
			} catch (err) {
				// ignore
			}
		}

		// Throttled handler attached to map mousemove
		map.on('mousemove', function(e) {
			_lastMouseLatLng = e.latlng;
			if (_hitTestTimer) return;
			_hitTestTimer = setTimeout(function() {
				_hitTestTimer = null;
				simulateHoverAtEvent(e);
			}, 40);
		});

		map.on('mouseout', function() {
			clearSimulatedHover();
		});

		// Rebuild mapping whenever a layer is added (e.g., at startup or dynamic changes)
		map.on('layeradd', buildPathToLayerMap);

		// Set transparency for all colored polygons (40% transparent => fillOpacity 0.6)
		// Store configured opacity so it can be reapplied when layers resetStyle is called during mouseout
		var _globalPolygonFillOpacity = null;
		function setAllPolygonsTransparency(opacity) {
			_globalPolygonFillOpacity = opacity;
			map.eachLayer(function(layer) {
				// GeoJSON layer -> iterate features
				if (layer instanceof L.GeoJSON) {
					layer.eachLayer(function(fl) {
                        // Only apply to polygons; skip point markers (circleMarkers)
                        var gt = fl && fl.feature && fl.feature.geometry && fl.feature.geometry.type;
                        if (gt === 'Point' || gt === 'MultiPoint' || (typeof L !== 'undefined' && L.CircleMarker && fl instanceof L.CircleMarker) || fl._icon) return;
                        // Skip layers that have their own per-layer opacity sliders
                        var paneName = fl && fl.options && fl.options.pane;
                        if (paneName === 'pane_Rudnotelo_19' || paneName === 'pane_Uticajnapovrinu_18' || paneName === 'pane_Podzonaproizvodnoindustrijskihaktivnosti_17' || paneName === 'pane_Podzonapristuparudniku_21' || paneName === 'pane_Podzonadeponije_20') return;
                        if (fl && fl.setStyle && (fl.options && (fl.options.fill || fl.options.fillColor))) {
							// don't override intentionally empty fills
							if (fl.options.fillOpacity === 0) return;
							fl.setStyle({ fillOpacity: opacity });
						}
					});
                } else if (layer && layer.setStyle && (layer.options && (layer.options.fill || layer.options.fillColor))) {
                    // Skip point markers
                    var lgt = layer && layer.feature && layer.feature.geometry && layer.feature.geometry.type;
                    if (lgt === 'Point' || lgt === 'MultiPoint' || (typeof L !== 'undefined' && L.CircleMarker && layer instanceof L.CircleMarker) || layer._icon) return;
                    // Skip layers that have their own per-layer opacity sliders
                    var lpane = layer && layer.options && layer.options.pane;
                    if (lpane === 'pane_Rudnotelo_19' || lpane === 'pane_Uticajnapovrinu_18' || lpane === 'pane_Podzonaproizvodnoindustrijskihaktivnosti_17' || lpane === 'pane_Podzonapristuparudniku_21' || lpane === 'pane_Podzonadeponije_20') return;
					if (layer.options.fillOpacity === 0) return;
					layer.setStyle({ fillOpacity: opacity });
				}
			});
		}

		// Ensure that when GeoJSON.resetStyle is called (e.g., on mouseout) we re-apply the configured transparency
		(function() {
			if (typeof L !== 'undefined' && L.GeoJSON && L.GeoJSON.prototype) {
				var _origResetStyle = L.GeoJSON.prototype.resetStyle;
				if (typeof _origResetStyle === 'function') {
					L.GeoJSON.prototype.resetStyle = function(layer) {
						_origResetStyle.call(this, layer);
						try {
                            // If we captured a marker's original style (e.g., circleMarkers), always restore it.
                            // This prevents resetStyle from reverting to Leaflet defaults (blue).
                            if (layer && layer.setStyle && layer._qgis2web_originalStyle) {
                                layer.setStyle(layer._qgis2web_originalStyle);
                            }
                            // Do not override panes that have per-layer opacity sliders
                            var paneName = layer && layer.options && layer.options.pane;
                            var isSliderPane = (paneName === 'pane_Rudnotelo_19' || paneName === 'pane_Uticajnapovrinu_18' || paneName === 'pane_Podzonaproizvodnoindustrijskihaktivnosti_17' || paneName === 'pane_Podzonapristuparudniku_21' || paneName === 'pane_Podzonadeponije_20');
                            if (!isSliderPane && _globalPolygonFillOpacity !== null && layer && layer.setStyle && (layer.options && (layer.options.fill || layer.options.fillColor)) && layer.options.fillOpacity !== 0) {
								layer.setStyle({ fillOpacity: _globalPolygonFillOpacity });
							}
						} catch (err) {
							// ignore
						}
					};
				}
			}
		})();

		// Run once (and again after small delay to catch late-added layers)
		setAllPolygonsTransparency(0.6);
		setTimeout(function(){ setAllPolygonsTransparency(0.6); }, 200);

        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        // Translate the measure tool button tooltip/title
        (function() {
            var measureToggle = document.getElementsByClassName('leaflet-control-measure-toggle')[0];
            if (!measureToggle) return;
            var srTitle = 'Merenje rastojanja i površina';
            measureToggle.title = srTitle;
            measureToggle.setAttribute('aria-label', srTitle);
        })();

        // Translate the Measure control panel UI (title/instructions/buttons)
        (function() {
            var dict = {
                'Measure distances and areas': 'Merenje rastojanja i površina',
                'Start creating a measurement by adding points to the map': 'Započnite merenje dodavanjem tačaka na mapu',
                'Cancel': 'Otkaži',
                'Finish measurement': 'Završi merenje',
                'Delete last point': 'Obriši poslednju tačku',
                'Clear all': 'Obriši sve'
            };

            function translateMeasureDom() {
                var container = document.querySelector('.leaflet-control-measure');
                if (!container) return;

                // Translate visible text nodes (usually in h3/p/span/a)
                var nodes = container.querySelectorAll('*');
                for (var i = 0; i < nodes.length; i++) {
                    var el = nodes[i];
                    if (!el) continue;
                    var txt = (el.textContent || '').trim();
                    if (dict[txt] && el.childElementCount === 0) {
                        el.textContent = dict[txt];
                    }
                    // Also translate common attributes
                    if (el.getAttribute) {
                        var t = el.getAttribute('title');
                        if (t && dict[t]) el.setAttribute('title', dict[t]);
                        var al = el.getAttribute('aria-label');
                        if (al && dict[al]) el.setAttribute('aria-label', dict[al]);
                    }
                }
            }

            // Run on toggle click (panel open/close)
            var measureToggle = document.getElementsByClassName('leaflet-control-measure-toggle')[0];
            if (measureToggle && !measureToggle.dataset.srTranslateBound) {
                measureToggle.dataset.srTranslateBound = '1';
                measureToggle.addEventListener('click', function() {
                    setTimeout(translateMeasureDom, 0);
                    setTimeout(translateMeasureDom, 50);
                });
            }

            // Keep translated if plugin re-renders its DOM
            if (!window._srMeasureObserver) {
                window._srMeasureObserver = new MutationObserver(function() {
                    translateMeasureDom();
                });
                window._srMeasureObserver.observe(document.body, { childList: true, subtree: true });
            }

            // Initial attempt
            setTimeout(translateMeasureDom, 0);
            setTimeout(translateMeasureDom, 50);
        })();
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
            map.setMaxBounds(map.getBounds());
        }
        map.createPane('pane_CartoDbPositron_0');
        map.getPane('pane_CartoDbPositron_0').style.zIndex = 400;
        var layer_CartoDbPositron_0 = L.tileLayer('https://basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            pane: 'pane_CartoDbPositron_0',
            opacity: 1.0,
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 20
        });
        layer_CartoDbPositron_0;
        map.addLayer(layer_CartoDbPositron_0);

        map.createPane('pane_OpenStreetMap_1');
        map.getPane('pane_OpenStreetMap_1').style.zIndex = 400;
        var layer_OpenStreetMap_1 = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_1',
            opacity: 1.0,
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_1;

        map.createPane('pane_OpenTopoMap_3');
        map.getPane('pane_OpenTopoMap_3').style.zIndex = 400;
        var layer_OpenTopoMap_3 = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenTopoMap_3',
            opacity: 1.0,
            attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)',
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 17,
            subdomains: 'abc'
        });
        layer_OpenTopoMap_3;

        map.createPane('pane_EsriWorldImagery_2');
        map.getPane('pane_EsriWorldImagery_2').style.zIndex = 400;
        var layer_EsriWorldImagery_2 = L.tileLayer(
            'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
            {
                pane: 'pane_EsriWorldImagery_2',
                opacity: 1.0,
                attribution: 'Tiles &copy; Esri — Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community',
                maxZoom: 28,
                minNativeZoom: 0,
                maxNativeZoom: 19
            }
        );
        layer_EsriWorldImagery_2;
        function pop_Katastarskeoptine_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Name'] !== null ? autolinker.link(feature.properties['Name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Katastarskeoptine_1_0() {
            return {
                pane: 'pane_Katastarskeoptine_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.2, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(145,82,45,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Katastarskeoptine_1');
        map.getPane('pane_Katastarskeoptine_1').style.zIndex = 401;
        map.getPane('pane_Katastarskeoptine_1').style['mix-blend-mode'] = 'normal';
        var layer_Katastarskeoptine_1 = new L.geoJson(json_Katastarskeoptine_1, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Katastarskeoptine_1',
            layerName: 'layer_Katastarskeoptine_1',
            pane: 'pane_Katastarskeoptine_1',
            onEachFeature: pop_Katastarskeoptine_1,
            style: style_Katastarskeoptine_1_0,
        });
        bounds_group.addLayer(layer_Katastarskeoptine_1);
        map.addLayer(layer_Katastarskeoptine_1);
        function pop_Granicaplana_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Name'] !== null ? autolinker.link(feature.properties['Name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Granicaplana_2_0() {
            return {
                pane: 'pane_Granicaplana_2',
                opacity: 1,
                color: 'rgba(100,100,100,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(196,60,57,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Granicaplana_2');
        map.getPane('pane_Granicaplana_2').style.zIndex = 402;
        map.getPane('pane_Granicaplana_2').style['mix-blend-mode'] = 'normal';
        var layer_Granicaplana_2 = new L.geoJson(json_Granicaplana_2, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Granicaplana_2',
            layerName: 'layer_Granicaplana_2',
            pane: 'pane_Granicaplana_2',
            onEachFeature: pop_Granicaplana_2,
            style: style_Granicaplana_2_0,
        });
        bounds_group.addLayer(layer_Granicaplana_2);
        map.addLayer(layer_Granicaplana_2);
        function pop_Postojeestanjesaobraajneinfrastrukture_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : (feature.properties['Naziv'] !== null ? autolinker.link(feature.properties['Naziv'].toLocaleString()) : '')) + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjesaobraajneinfrastrukture_3_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Državni put Ib reda':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Državni put IIa reda':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Državni put IIb reda':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Lokalni put':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga Šabac-Loznica':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga Valjevo-Loznica':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga-Servisna':
                    return {
                pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Postojeestanjesaobraajneinfrastrukture_3');
        map.getPane('pane_Postojeestanjesaobraajneinfrastrukture_3').style.zIndex = 403;
        map.getPane('pane_Postojeestanjesaobraajneinfrastrukture_3').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjesaobraajneinfrastrukture_3 = new L.geoJson(json_Postojeestanjesaobraajneinfrastrukture_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjesaobraajneinfrastrukture_3',
            layerName: 'layer_Postojeestanjesaobraajneinfrastrukture_3',
            pane: 'pane_Postojeestanjesaobraajneinfrastrukture_3',
            onEachFeature: pop_Postojeestanjesaobraajneinfrastrukture_3,
            style: style_Postojeestanjesaobraajneinfrastrukture_3_0,
        });
        bounds_group.addLayer(layer_Postojeestanjesaobraajneinfrastrukture_3);

        // Added from pruga.geojson (original CRS: EPSG:3857; reprojected to WGS84 lon/lat)
        // Category: Postojeće stanje saobraćajne infrastrukture -> Pruga Šabac-Loznica
        try {
            layer_Postojeestanjesaobraajneinfrastrukture_3.addData({
                "type": "Feature",
                "properties": {
                    "Tip": "Pruga Šabac-Loznica",
                    "Naziv": "Pruga Šabac-Loznica (dodato)",
                    "Stanje": "Postojeće"
                },
                "geometry": {
                    "type": "MultiLineString",
                    "coordinates": [[
                        [19.2961958806335, 44.6074242801404],
                        [19.2881563799259, 44.5889941495509],
                        [19.2878949327484, 44.5887614085108],
                        [19.2867184204497, 44.5876442385451],
                        [19.2850843755905, 44.5869459964129],
                        [19.2824045420213, 44.5858287915553],
                        [19.2807051353676, 44.5849443224816],
                        [19.2714074201184, 44.5732529372654],
                        [19.2422152087077, 44.5485569344246],
                        [19.2393175024906, 44.5466781577871]
                    ]]
                }
            });
        } catch (err) {
            try { console && console.warn && console.warn('Failed to add Pruga Šabac-Loznica feature', err); } catch (e) { }
        }
        // map.addLayer(layer_Postojeestanjesaobraajneinfrastrukture_3); // Hidden by default
        function pop_Planiranostanjesaobraajneinfrastrukture_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : (feature.properties['Naziv'] !== null ? autolinker.link(feature.properties['Naziv'].toLocaleString()) : '')) + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjesaobraajneinfrastrukture_4_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Državni put Ib reda':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '8.0,4.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Lokalni put':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Obilaznica oko Loznice':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(230,1,0,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga Šabac-Loznica':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '4.0,2.0,1.0,2.0',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga Valjevo-Loznica':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '4.0,2.0,1.0,2.0',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Pruga-Servisna':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(0,0,0,1.0)',
                dashArray: '4.0,2.0,1.0,2.0',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Saobraćajnice':
                    return {
                pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
                opacity: 0.7,
                color: 'rgba(167,1,3,1.0)',
                dashArray: '4.0,2.0,1.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Planiranostanjesaobraajneinfrastrukture_4');
        map.getPane('pane_Planiranostanjesaobraajneinfrastrukture_4').style.zIndex = 404;
        map.getPane('pane_Planiranostanjesaobraajneinfrastrukture_4').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjesaobraajneinfrastrukture_4 = new L.geoJson(json_Planiranostanjesaobraajneinfrastrukture_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjesaobraajneinfrastrukture_4',
            layerName: 'layer_Planiranostanjesaobraajneinfrastrukture_4',
            pane: 'pane_Planiranostanjesaobraajneinfrastrukture_4',
            onEachFeature: pop_Planiranostanjesaobraajneinfrastrukture_4,
            style: style_Planiranostanjesaobraajneinfrastrukture_4_0,
        });
        bounds_group.addLayer(layer_Planiranostanjesaobraajneinfrastrukture_4);
        map.addLayer(layer_Planiranostanjesaobraajneinfrastrukture_4);
        function pop_Postojeestanjevodneinfrastrukture_5(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjevodneinfrastrukture_5_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Primarna vodovodna mreža':
                    return {
                pane: 'pane_Postojeestanjevodneinfrastrukture_5',
                opacity: 0.7,
                color: 'rgba(0,191,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Postojeestanjevodneinfrastrukture_5');
        map.getPane('pane_Postojeestanjevodneinfrastrukture_5').style.zIndex = 1050;
        map.getPane('pane_Postojeestanjevodneinfrastrukture_5').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjevodneinfrastrukture_5 = new L.geoJson(json_Postojeestanjevodneinfrastrukture_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjevodneinfrastrukture_5',
            layerName: 'layer_Postojeestanjevodneinfrastrukture_5',
            pane: 'pane_Postojeestanjevodneinfrastrukture_5',
            onEachFeature: pop_Postojeestanjevodneinfrastrukture_5,
            style: style_Postojeestanjevodneinfrastrukture_5_0,
        });
        bounds_group.addLayer(layer_Postojeestanjevodneinfrastrukture_5);
        map.addLayer(layer_Postojeestanjevodneinfrastrukture_5);
        function pop_Planiranostanjevodneinfrastrukture_6(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjevodneinfrastrukture_6_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Cevovod otpadne vode':
                    return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_6',
                opacity: 0.7,
                color: 'rgba(0,0,165,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Cevovod tehničke vode':
                    return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_6',
                opacity: 0.7,
                color: 'rgba(0,63,255,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Fekalna kanalizacija':
                    return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_6',
                opacity: 0.7,
                color: 'rgba(38,19,0,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Primarna vodovodna mreža':
                    return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_6',
                opacity: 0.7,
                color: 'rgba(0,191,255,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Regionalni kanalizacioni kolektori':
                    return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_6',
                opacity: 0.7,
                color: 'rgba(165,124,0,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Planiranostanjevodneinfrastrukture_6');
        map.getPane('pane_Planiranostanjevodneinfrastrukture_6').style.zIndex = 1050;
        map.getPane('pane_Planiranostanjevodneinfrastrukture_6').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjevodneinfrastrukture_6 = new L.geoJson(json_Planiranostanjevodneinfrastrukture_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjevodneinfrastrukture_6',
            layerName: 'layer_Planiranostanjevodneinfrastrukture_6',
            pane: 'pane_Planiranostanjevodneinfrastrukture_6',
            onEachFeature: pop_Planiranostanjevodneinfrastrukture_6,
            style: style_Planiranostanjevodneinfrastrukture_6_0,
        });
        bounds_group.addLayer(layer_Planiranostanjevodneinfrastrukture_6);
        map.addLayer(layer_Planiranostanjevodneinfrastrukture_6);
        function pop_Postojeestanjeelektroenergetskeinfrastukture_7(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjeelektroenergetskeinfrastukture_7_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Dalekovod 110 kV':
                    return {
                pane: 'pane_Postojeestanjeelektroenergetskeinfrastukture_7',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Dalekovod 220 kV':
                    return {
                pane: 'pane_Postojeestanjeelektroenergetskeinfrastukture_7',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 2.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Dalekovod 35 kV':
                    return {
                pane: 'pane_Postojeestanjeelektroenergetskeinfrastukture_7',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Postojeestanjeelektroenergetskeinfrastukture_7');
        map.getPane('pane_Postojeestanjeelektroenergetskeinfrastukture_7').style.zIndex = 407;
        map.getPane('pane_Postojeestanjeelektroenergetskeinfrastukture_7').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjeelektroenergetskeinfrastukture_7 = new L.geoJson(json_Postojeestanjeelektroenergetskeinfrastukture_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjeelektroenergetskeinfrastukture_7',
            layerName: 'layer_Postojeestanjeelektroenergetskeinfrastukture_7',
            pane: 'pane_Postojeestanjeelektroenergetskeinfrastukture_7',
            onEachFeature: pop_Postojeestanjeelektroenergetskeinfrastukture_7,
            style: style_Postojeestanjeelektroenergetskeinfrastukture_7_0,
        });
        bounds_group.addLayer(layer_Postojeestanjeelektroenergetskeinfrastukture_7);
        map.addLayer(layer_Postojeestanjeelektroenergetskeinfrastukture_7);
        function pop_Planiranostanjeelektroenergetskeinfrastukture_8(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjeelektroenergetskeinfrastukture_8_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Dalekovod 10 kV':
                    return {
                pane: 'pane_Planiranostanjeelektroenergetskeinfrastukture_8',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Dalekovod 110 kV':
                    return {
                pane: 'pane_Planiranostanjeelektroenergetskeinfrastukture_8',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
                case 'Dalekovod 35 kV':
                    return {
                pane: 'pane_Planiranostanjeelektroenergetskeinfrastukture_8',
                opacity: 0.7,
                color: 'rgba(191,0,255,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Planiranostanjeelektroenergetskeinfrastukture_8');
        map.getPane('pane_Planiranostanjeelektroenergetskeinfrastukture_8').style.zIndex = 408;
        map.getPane('pane_Planiranostanjeelektroenergetskeinfrastukture_8').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjeelektroenergetskeinfrastukture_8 = new L.geoJson(json_Planiranostanjeelektroenergetskeinfrastukture_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjeelektroenergetskeinfrastukture_8',
            layerName: 'layer_Planiranostanjeelektroenergetskeinfrastukture_8',
            pane: 'pane_Planiranostanjeelektroenergetskeinfrastukture_8',
            onEachFeature: pop_Planiranostanjeelektroenergetskeinfrastukture_8,
            style: style_Planiranostanjeelektroenergetskeinfrastukture_8_0,
        });
        bounds_group.addLayer(layer_Planiranostanjeelektroenergetskeinfrastukture_8);
        map.addLayer(layer_Planiranostanjeelektroenergetskeinfrastukture_8);
        function pop_Postojeestanjegasneinfrastrukture_9(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjegasneinfrastrukture_9_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Magistralni gasovod':
                    return {
                pane: 'pane_Postojeestanjegasneinfrastrukture_9',
                opacity: 0.7,
                color: 'rgba(0,76,19,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Postojeestanjegasneinfrastrukture_9');
        map.getPane('pane_Postojeestanjegasneinfrastrukture_9').style.zIndex = 409;
        map.getPane('pane_Postojeestanjegasneinfrastrukture_9').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjegasneinfrastrukture_9 = new L.geoJson(json_Postojeestanjegasneinfrastrukture_9, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjegasneinfrastrukture_9',
            layerName: 'layer_Postojeestanjegasneinfrastrukture_9',
            pane: 'pane_Postojeestanjegasneinfrastrukture_9',
            onEachFeature: pop_Postojeestanjegasneinfrastrukture_9,
            style: style_Postojeestanjegasneinfrastrukture_9_0,
        });
        bounds_group.addLayer(layer_Postojeestanjegasneinfrastrukture_9);
        map.addLayer(layer_Postojeestanjegasneinfrastrukture_9);

        // Added from 'gasovod valjevo loznica.geojson' (original CRS: EPSG:3857; reprojected to WGS84 lon/lat)
        // Category: Postojeće stanje gasne infrastrukture -> Magistralni gasovod
        try {
            layer_Postojeestanjegasneinfrastrukture_9.addData({
                "type": "Feature",
                "properties": {
                    // This layer's style switch only supports 'Magistralni gasovod'
                    "Tip": "Magistralni gasovod",
                    "Naziv": "Gasovod Beograd-Valjevo-Loznica (dodato)",
                    "Stanje": "Postojeće"
                },
                "geometry": {
                    "type": "MultiLineString",
                    "coordinates": [[
                        [19.5011748259, 44.4451416671],
                        [19.5002322418, 44.4460638243],
                        [19.4990452840, 44.4469859669],
                        [19.4972997578, 44.4478333283],
                        [19.4952749475, 44.4481573162],
                        [19.4931803161, 44.4482570045],
                        [19.4903874742, 44.4484813023],
                        [19.4884673954, 44.4482819265],
                        [19.4838941169, 44.4487554430],
                        [19.4794255699, 44.4501759696],
                        [19.4784131647, 44.4511977304],
                        [19.4790240989, 44.4523440750],
                        [19.4792335620, 44.4545121000],
                        [19.4757425097, 44.4571784112],
                        [19.4738049756, 44.4582748029],
                        [19.4726703836, 44.4595206776],
                        [19.4706979391, 44.4600190200],
                        [19.4693538839, 44.4607540673],
                        [19.4688476813, 44.4621743020],
                        [19.4675385367, 44.4651392420],
                        [19.4681843814, 44.4669579963],
                        [19.4678003656, 44.4679919203],
                        [19.4674687157, 44.4686521273],
                        [19.4666134078, 44.4695739133],
                        [19.4649027922, 44.4708693716],
                        [19.4636983791, 44.4720900656],
                        [19.4629478029, 44.4743694566],
                        [19.4600851400, 44.4749174936],
                        [19.4597185795, 44.4751541443],
                        [19.4567686403, 44.4807712041],
                        [19.4536441484, 44.4847314667],
                        [19.4505371118, 44.4872718709],
                        [19.4470111490, 44.4885669364],
                        [19.4368172762, 44.4898744252],
                        [19.4362936183, 44.4890401262],
                        [19.4325931029, 44.4900861111],
                        [19.4293289689, 44.4914309213],
                        [19.4273565244, 44.4947430068],
                        [19.4229228879, 44.4980922554],
                        [19.4107042047, 44.5033709778],
                        [19.4093601496, 44.5042050718],
                        [19.4063752998, 44.5055495564],
                        [19.4034428159, 44.5053752731],
                        [19.4014180055, 44.5062591330],
                        [19.3897055250, 44.5095703763],
                        [19.3879774541, 44.5103670384],
                        [19.3869650489, 44.5112508226],
                        [19.3854813516, 44.5119852246],
                        [19.3847482307, 44.5132050584],
                        [19.3750954710, 44.5201999386],
                        [19.3714124107, 44.5214196005],
                        [19.3705047371, 44.5213573734],
                        [19.3646048587, 44.5239210719],
                        [19.3591588171, 44.5259122161],
                        [19.3578933106, 44.5265033240],
                        [19.3558597726, 44.5268766521],
                        [19.3546553596, 44.5269388733],
                        [19.3534462094, 44.5269023348]
                    ]]
                }
            });
        } catch (err) {
            try { console && console.warn && console.warn('Failed to add Gasovod Beograd-Valjevo-Loznica feature', err); } catch (e) { }
        }
        function pop_Planiranostanjegasneinfrastrukture_10(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjegasneinfrastrukture_10_0(feature) {
            switch(String(feature.properties['Tip'])) {
                case 'Gasovod':
                    return {
                pane: 'pane_Planiranostanjegasneinfrastrukture_10',
                opacity: 0.7,
                color: 'rgba(0,76,19,1.0)',
                dashArray: '4.0,2.0',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 1.0,
                fillOpacity: 0,
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Planiranostanjegasneinfrastrukture_10');
        map.getPane('pane_Planiranostanjegasneinfrastrukture_10').style.zIndex = 410;
        map.getPane('pane_Planiranostanjegasneinfrastrukture_10').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjegasneinfrastrukture_10 = new L.geoJson(json_Planiranostanjegasneinfrastrukture_10, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjegasneinfrastrukture_10',
            layerName: 'layer_Planiranostanjegasneinfrastrukture_10',
            pane: 'pane_Planiranostanjegasneinfrastrukture_10',
            onEachFeature: pop_Planiranostanjegasneinfrastrukture_10,
            style: style_Planiranostanjegasneinfrastrukture_10_0,
        });
        bounds_group.addLayer(layer_Planiranostanjegasneinfrastrukture_10);
        map.addLayer(layer_Planiranostanjegasneinfrastrukture_10);
        function pop_Postojeestanjeelektroenergetskihobjekata_11(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjeelektroenergetskihobjekata_11_0() {
            return {
                pane: 'pane_Postojeestanjeelektroenergetskihobjekata_11',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Postojeestanjeelektroenergetskihobjekata_11.svg',
            iconSize: [7.6, 7.6]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Postojeestanjeelektroenergetskihobjekata_11');
        map.getPane('pane_Postojeestanjeelektroenergetskihobjekata_11').style.zIndex = 1100;
        map.getPane('pane_Postojeestanjeelektroenergetskihobjekata_11').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjeelektroenergetskihobjekata_11 = new L.geoJson(json_Postojeestanjeelektroenergetskihobjekata_11, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjeelektroenergetskihobjekata_11',
            layerName: 'layer_Postojeestanjeelektroenergetskihobjekata_11',
            pane: 'pane_Postojeestanjeelektroenergetskihobjekata_11',
            onEachFeature: pop_Postojeestanjeelektroenergetskihobjekata_11,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Postojeestanjeelektroenergetskihobjekata_11_0(feature));
            },
        });
        bounds_group.addLayer(layer_Postojeestanjeelektroenergetskihobjekata_11);
        map.addLayer(layer_Postojeestanjeelektroenergetskihobjekata_11);
        function pop_Planiranostanjeelektroenergetskihobjekata_12(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjeelektroenergetskihobjekata_12_0() {
            return {
                pane: 'pane_Planiranostanjeelektroenergetskihobjekata_12',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Planiranostanjeelektroenergetskihobjekata_12.svg',
            iconSize: [7.6, 7.6]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Planiranostanjeelektroenergetskihobjekata_12');
        map.getPane('pane_Planiranostanjeelektroenergetskihobjekata_12').style.zIndex = 1100;
        map.getPane('pane_Planiranostanjeelektroenergetskihobjekata_12').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjeelektroenergetskihobjekata_12 = new L.geoJson(json_Planiranostanjeelektroenergetskihobjekata_12, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjeelektroenergetskihobjekata_12',
            layerName: 'layer_Planiranostanjeelektroenergetskihobjekata_12',
            pane: 'pane_Planiranostanjeelektroenergetskihobjekata_12',
            onEachFeature: pop_Planiranostanjeelektroenergetskihobjekata_12,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Planiranostanjeelektroenergetskihobjekata_12_0(feature));
            },
        });
        bounds_group.addLayer(layer_Planiranostanjeelektroenergetskihobjekata_12);
        map.addLayer(layer_Planiranostanjeelektroenergetskihobjekata_12);
        function pop_Planiranostanjegasnihobjekata_13(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjegasnihobjekata_13_0() {
            return {
                pane: 'pane_Planiranostanjegasnihobjekata_13',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Planiranostanjegasnihobjekata_13.svg',
            iconSize: [7.6, 7.6]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Planiranostanjegasnihobjekata_13');
        map.getPane('pane_Planiranostanjegasnihobjekata_13').style.zIndex = 1100;
        map.getPane('pane_Planiranostanjegasnihobjekata_13').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjegasnihobjekata_13 = new L.geoJson(json_Planiranostanjegasnihobjekata_13, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjegasnihobjekata_13',
            layerName: 'layer_Planiranostanjegasnihobjekata_13',
            pane: 'pane_Planiranostanjegasnihobjekata_13',
            onEachFeature: pop_Planiranostanjegasnihobjekata_13,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Planiranostanjegasnihobjekata_13_0(feature));
            },
        });
        bounds_group.addLayer(layer_Planiranostanjegasnihobjekata_13);
        map.addLayer(layer_Planiranostanjegasnihobjekata_13);
        function pop_Postojeestanjevodneinfrastrukture_14(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Postojeestanjevodneinfrastrukture_14_0() {
            return {
                pane: 'pane_Postojeestanjevodneinfrastrukture_14',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Postojeestanjevodneinfrastrukture_14.svg',
            iconSize: [7.6, 7.6]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Postojeestanjevodneinfrastrukture_14');
        map.getPane('pane_Postojeestanjevodneinfrastrukture_14').style.zIndex = 1100;
        map.getPane('pane_Postojeestanjevodneinfrastrukture_14').style['mix-blend-mode'] = 'normal';
        var layer_Postojeestanjevodneinfrastrukture_14 = new L.geoJson(json_Postojeestanjevodneinfrastrukture_14, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Postojeestanjevodneinfrastrukture_14',
            layerName: 'layer_Postojeestanjevodneinfrastrukture_14',
            pane: 'pane_Postojeestanjevodneinfrastrukture_14',
            onEachFeature: pop_Postojeestanjevodneinfrastrukture_14,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Postojeestanjevodneinfrastrukture_14_0(feature));
            },
        });
        bounds_group.addLayer(layer_Postojeestanjevodneinfrastrukture_14);
        map.addLayer(layer_Postojeestanjevodneinfrastrukture_14);
        function pop_Planiranostanjevodneinfrastrukture_15(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Tip'] !== null ? autolinker.link(feature.properties['Tip'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Planiranostanjevodneinfrastrukture_15_0() {
            return {
                pane: 'pane_Planiranostanjevodneinfrastrukture_15',
        rotationAngle: 0.0,
        rotationOrigin: 'center center',
        icon: L.icon({
            iconUrl: 'markers/Planiranostanjevodneinfrastrukture_15.svg',
            iconSize: [7.6, 7.6]
        }),
                interactive: true,
            }
        }
        map.createPane('pane_Planiranostanjevodneinfrastrukture_15');
        map.getPane('pane_Planiranostanjevodneinfrastrukture_15').style.zIndex = 1100;
        map.getPane('pane_Planiranostanjevodneinfrastrukture_15').style['mix-blend-mode'] = 'normal';
        var layer_Planiranostanjevodneinfrastrukture_15 = new L.geoJson(json_Planiranostanjevodneinfrastrukture_15, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Planiranostanjevodneinfrastrukture_15',
            layerName: 'layer_Planiranostanjevodneinfrastrukture_15',
            pane: 'pane_Planiranostanjevodneinfrastrukture_15',
            onEachFeature: pop_Planiranostanjevodneinfrastrukture_15,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.marker(latlng, style_Planiranostanjevodneinfrastrukture_15_0(feature));
            },
        });
        bounds_group.addLayer(layer_Planiranostanjevodneinfrastrukture_15);
        map.addLayer(layer_Planiranostanjevodneinfrastrukture_15);
        function pop_Pozajmitamaterijalaglina_16(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Pozajmitamaterijalaglina_16_0() {
            return {
                pane: 'pane_Pozajmitamaterijalaglina_16',
                opacity: 1,
                color: 'rgba(107,107,107,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(125,139,143,1.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Pozajmitamaterijalaglina_16');
        map.getPane('pane_Pozajmitamaterijalaglina_16').style.zIndex = 416;
        map.getPane('pane_Pozajmitamaterijalaglina_16').style['mix-blend-mode'] = 'normal';
        var layer_Pozajmitamaterijalaglina_16 = new L.geoJson(json_Pozajmitamaterijalaglina_16, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Pozajmitamaterijalaglina_16',
            layerName: 'layer_Pozajmitamaterijalaglina_16',
            pane: 'pane_Pozajmitamaterijalaglina_16',
            onEachFeature: pop_Pozajmitamaterijalaglina_16,
            style: style_Pozajmitamaterijalaglina_16_0,
        });
        bounds_group.addLayer(layer_Pozajmitamaterijalaglina_16);
        map.addLayer(layer_Pozajmitamaterijalaglina_16);
        function pop_Podzonaproizvodnoindustrijskihaktivnosti_17(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof __applyAllOpacityStyles === 'function') {
                        __applyAllOpacityStyles();
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Podzonaproizvodnoindustrijskihaktivnosti_17_0() {
            return {
                pane: 'pane_Podzonaproizvodnoindustrijskihaktivnosti_17',
                opacity: __getLayerOpacity('Podzonaproizvodnoindustrijskihaktivnosti_17', 0.5),
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3, 
                fill: true,
                fillOpacity: __getLayerOpacity('Podzonaproizvodnoindustrijskihaktivnosti_17', 0.5),
                fillColor: 'rgba(186,122,200,0.7019607843137254)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Podzonaproizvodnoindustrijskihaktivnosti_17');
        map.getPane('pane_Podzonaproizvodnoindustrijskihaktivnosti_17').style.zIndex = 417;
        map.getPane('pane_Podzonaproizvodnoindustrijskihaktivnosti_17').style['mix-blend-mode'] = 'normal';
        var layer_Podzonaproizvodnoindustrijskihaktivnosti_17 = new L.geoJson(json_Podzonaproizvodnoindustrijskihaktivnosti_17, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Podzonaproizvodnoindustrijskihaktivnosti_17',
            layerName: 'layer_Podzonaproizvodnoindustrijskihaktivnosti_17',
            pane: 'pane_Podzonaproizvodnoindustrijskihaktivnosti_17',
            onEachFeature: pop_Podzonaproizvodnoindustrijskihaktivnosti_17,
            style: style_Podzonaproizvodnoindustrijskihaktivnosti_17_0,
        });
        bounds_group.addLayer(layer_Podzonaproizvodnoindustrijskihaktivnosti_17);
        map.addLayer(layer_Podzonaproizvodnoindustrijskihaktivnosti_17);
        function pop_Uticajnapovrinu_18(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof __applyAllOpacityStyles === 'function') {
                        __applyAllOpacityStyles();
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        // Create stripe patterns to match legend symbols
        try {
            var pattern_zatit_zemlja = new L.StripePattern({
                color: 'rgba(89,225,197,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 5,
                spaceWidth: 6,
                angle: 90
            });
            pattern_zatit_zemlja.addTo(map);

            var pattern_zatit_voda = new L.StripePattern({
                color: 'rgba(89,225,197,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 6,
                spaceWidth: 6,
                angle: 0
            });
            pattern_zatit_voda.addTo(map);

            var pattern_overene = new L.StripePattern({
                color: 'rgba(203,0,0,0.7)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 4,
                spaceWidth: 6,
                angle: 90
            });
            pattern_overene.addTo(map);

            var pattern_rudno = new L.StripePattern({
                color: 'rgba(178,35,35,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 4,
                spaceWidth: 6,
                angle: 45
            });
            pattern_rudno.addTo(map);

            var pattern_uticaj = new L.StripePattern({
                color: 'rgba(167,31,31,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 4,
                spaceWidth: 6,
                angle: -45
            });
            pattern_uticaj.addTo(map);

            var pattern_postupak = new L.StripePattern({
                color: 'rgba(3,116,76,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 4,
                spaceWidth: 6,
                angle: -45
            });
            pattern_postupak.addTo(map);

            var pattern_prirodna = new L.StripePattern({
                color: 'rgba(114,155,111,1)',
                spaceColor: 'rgba(255,255,255,0)',
                weight: 4,
                spaceWidth: 6,
                angle: -45
            });
            pattern_prirodna.addTo(map);
        } catch (err) {
            // leaflet.pattern might not be available: ignore
        }

        function style_Uticajnapovrinu_18_0() {
            return {
                pane: 'pane_Uticajnapovrinu_18',
                opacity: __getLayerOpacity('Uticajnapovrinu_18', 0.5),
                color: 'rgba(71,71,71,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.7,
                fill: true,
                fillOpacity: __getLayerOpacity('Uticajnapovrinu_18', 0.5),
                fillColor: 'rgba(167,31,31,1.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Uticajnapovrinu_18');
        map.getPane('pane_Uticajnapovrinu_18').style.zIndex = 418;
        map.getPane('pane_Uticajnapovrinu_18').style['mix-blend-mode'] = 'normal';
        var layer_Uticajnapovrinu_18 = new L.geoJson(json_Uticajnapovrinu_18, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Uticajnapovrinu_18',
            layerName: 'layer_Uticajnapovrinu_18',
            pane: 'pane_Uticajnapovrinu_18',
            onEachFeature: pop_Uticajnapovrinu_18,
            style: style_Uticajnapovrinu_18_0,
        });
        bounds_group.addLayer(layer_Uticajnapovrinu_18);
        map.addLayer(layer_Uticajnapovrinu_18);
        function pop_Rudnotelo_19(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof __applyAllOpacityStyles === 'function') {
                        __applyAllOpacityStyles();
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Rudnotelo_19_0() {
            return {
                pane: 'pane_Rudnotelo_19',
                opacity: __getLayerOpacity('Rudnotelo_19', 0.5),
                color: 'rgba(178,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3
                ,
                fill: true,
                fillOpacity: __getLayerOpacity('Rudnotelo_19', 0.5),
                fillColor: 'rgba(178,35,35,1.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Rudnotelo_19');
        map.getPane('pane_Rudnotelo_19').style.zIndex = 419;
        map.getPane('pane_Rudnotelo_19').style['mix-blend-mode'] = 'normal';
        var layer_Rudnotelo_19 = new L.geoJson(json_Rudnotelo_19, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Rudnotelo_19',
            layerName: 'layer_Rudnotelo_19',
            pane: 'pane_Rudnotelo_19',
            onEachFeature: pop_Rudnotelo_19,
            style: style_Rudnotelo_19_0,
        });
        bounds_group.addLayer(layer_Rudnotelo_19);
        map.addLayer(layer_Rudnotelo_19);
        function pop_Podzonadeponije_20(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof __applyAllOpacityStyles === 'function') {
                        __applyAllOpacityStyles();
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Podzonadeponije_20_0() {
            return {
                pane: 'pane_Podzonadeponije_20',
                opacity: __getLayerOpacity('Podzonadeponije_20', 0.5),
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3,
                fill: true,
                fillOpacity: __getLayerOpacity('Podzonadeponije_20', 0.5),
                fillColor: 'rgba(158,188,216,1.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Podzonadeponije_20');
        map.getPane('pane_Podzonadeponije_20').style.zIndex = 420;
        map.getPane('pane_Podzonadeponije_20').style['mix-blend-mode'] = 'normal';
        var layer_Podzonadeponije_20 = new L.geoJson(json_Podzonadeponije_20, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Podzonadeponije_20',
            layerName: 'layer_Podzonadeponije_20',
            pane: 'pane_Podzonadeponije_20',
            onEachFeature: pop_Podzonadeponije_20,
            style: style_Podzonadeponije_20_0,
        });
        bounds_group.addLayer(layer_Podzonadeponije_20);
        map.addLayer(layer_Podzonadeponije_20);
        function pop_Podzonapristuparudniku_21(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof __applyAllOpacityStyles === 'function') {
                        __applyAllOpacityStyles();
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Podzonapristuparudniku_21_0() {
            return {
                pane: 'pane_Podzonapristuparudniku_21',
                opacity: __getLayerOpacity('Podzonapristuparudniku_21', 0.5),
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3, 
                fill: true,
                fillOpacity: __getLayerOpacity('Podzonapristuparudniku_21', 0.5),
                fillColor: 'rgba(189,210,255,1.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Podzonapristuparudniku_21');
        map.getPane('pane_Podzonapristuparudniku_21').style.zIndex = 421;
        map.getPane('pane_Podzonapristuparudniku_21').style['mix-blend-mode'] = 'normal';
        var layer_Podzonapristuparudniku_21 = new L.geoJson(json_Podzonapristuparudniku_21, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Podzonapristuparudniku_21',
            layerName: 'layer_Podzonapristuparudniku_21',
            pane: 'pane_Podzonapristuparudniku_21',
            onEachFeature: pop_Podzonapristuparudniku_21,
            style: style_Podzonapristuparudniku_21_0,
        });
        bounds_group.addLayer(layer_Podzonapristuparudniku_21);
        map.addLayer(layer_Podzonapristuparudniku_21);
        function pop_Eksploatacionapolja_22(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Eksploatacionapolja_22_0() {
            return {
                pane: 'pane_Eksploatacionapolja_22',
                opacity: 1,
                color: 'rgba(173,51,12,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 0.7,
                fillColor: 'rgba(213,180,60,0.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Eksploatacionapolja_22');
        map.getPane('pane_Eksploatacionapolja_22').style.zIndex = 422;
        map.getPane('pane_Eksploatacionapolja_22').style['mix-blend-mode'] = 'normal';
        var layer_Eksploatacionapolja_22 = new L.geoJson(json_Eksploatacionapolja_22, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Eksploatacionapolja_22',
            layerName: 'layer_Eksploatacionapolja_22',
            pane: 'pane_Eksploatacionapolja_22',
            onEachFeature: pop_Eksploatacionapolja_22,
            style: style_Eksploatacionapolja_22_0,
        });
        bounds_group.addLayer(layer_Eksploatacionapolja_22);
        map.addLayer(layer_Eksploatacionapolja_22);
        function pop_Istraivanjepodzemnihvoda_23(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Istraivanjepodzemnihvoda_23_0() {
            return {
                pane: 'pane_Istraivanjepodzemnihvoda_23',
                opacity: 1,
                color: 'rgba(6,133,169,1.0)',
                dashArray: '5.0,1.0',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: false,
                fillOpacity: 0,
                fillColor: 'rgba(31,120,180,0.0)',
                className: 'poly-stroke-events',
                interactive: false,
            }
        }
        map.createPane('pane_Istraivanjepodzemnihvoda_23');
        map.getPane('pane_Istraivanjepodzemnihvoda_23').style.zIndex = 423;
        map.getPane('pane_Istraivanjepodzemnihvoda_23').style['mix-blend-mode'] = 'normal';
        var layer_Istraivanjepodzemnihvoda_23 = new L.geoJson(json_Istraivanjepodzemnihvoda_23, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Istraivanjepodzemnihvoda_23',
            layerName: 'layer_Istraivanjepodzemnihvoda_23',
            pane: 'pane_Istraivanjepodzemnihvoda_23',
            onEachFeature: pop_Istraivanjepodzemnihvoda_23,
            style: style_Istraivanjepodzemnihvoda_23_0,
        });
        bounds_group.addLayer(layer_Istraivanjepodzemnihvoda_23);
        map.addLayer(layer_Istraivanjepodzemnihvoda_23);
        function pop_Aktivnaistranapolja_24(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Aktivnaistranapolja_24_0() {
            return {
                pane: 'pane_Aktivnaistranapolja_24',
                opacity: 0.8,
                color: 'rgba(203,0,0,0.8)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: false,
                fillOpacity: 0,
                fillColor: 'rgba(232,113,141,0.0)',
                className: 'poly-stroke-events',
                interactive: false,
            }
        }
        map.createPane('pane_Aktivnaistranapolja_24');
        map.getPane('pane_Aktivnaistranapolja_24').style.zIndex = 424;
        map.getPane('pane_Aktivnaistranapolja_24').style['mix-blend-mode'] = 'normal';
        var layer_Aktivnaistranapolja_24 = new L.geoJson(json_Aktivnaistranapolja_24, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Aktivnaistranapolja_24',
            layerName: 'layer_Aktivnaistranapolja_24',
            pane: 'pane_Aktivnaistranapolja_24',
            onEachFeature: pop_Aktivnaistranapolja_24,
            style: style_Aktivnaistranapolja_24_0,
        });
        bounds_group.addLayer(layer_Aktivnaistranapolja_24);
        map.addLayer(layer_Aktivnaistranapolja_24);
        function pop_Overenerezerve_25(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Overenerezerve_25_0() {
            return {
                pane: 'pane_Overenerezerve_25',
                opacity: 0.7,
                color: 'rgba(203,0,0,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 0.7,
                fillColor: 'rgba(203,0,0,0.7)',
                fillPattern: typeof pattern_overene !== 'undefined' ? pattern_overene : null,
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Overenerezerve_25');
        map.getPane('pane_Overenerezerve_25').style.zIndex = 425;
        map.getPane('pane_Overenerezerve_25').style['mix-blend-mode'] = 'normal';
        var layer_Overenerezerve_25 = new L.geoJson(json_Overenerezerve_25, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Overenerezerve_25',
            layerName: 'layer_Overenerezerve_25',
            pane: 'pane_Overenerezerve_25',
            onEachFeature: pop_Overenerezerve_25,
            style: style_Overenerezerve_25_0,
        });
        bounds_group.addLayer(layer_Overenerezerve_25);
        map.addLayer(layer_Overenerezerve_25);
        function pop_ZatitavodavodosnabdevanjaIIIstepen_26(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_ZatitavodavodosnabdevanjaIIIstepen_26_0() {
            return {
                pane: 'pane_ZatitavodavodosnabdevanjaIIIstepen_26',
                opacity: 1,
                color: 'rgba(89,225,197,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(89,225,197,1.0)',
                fillPattern: typeof pattern_zatit_voda !== 'undefined' ? pattern_zatit_voda : null,
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_ZatitavodavodosnabdevanjaIIIstepen_26');
        map.getPane('pane_ZatitavodavodosnabdevanjaIIIstepen_26').style.zIndex = 426;
        map.getPane('pane_ZatitavodavodosnabdevanjaIIIstepen_26').style['mix-blend-mode'] = 'normal';
        var layer_ZatitavodavodosnabdevanjaIIIstepen_26 = new L.geoJson(json_ZatitavodavodosnabdevanjaIIIstepen_26, {
            attribution: '',
            interactive: true,
            dataVar: 'json_ZatitavodavodosnabdevanjaIIIstepen_26',
            layerName: 'layer_ZatitavodavodosnabdevanjaIIIstepen_26',
            pane: 'pane_ZatitavodavodosnabdevanjaIIIstepen_26',
            onEachFeature: pop_ZatitavodavodosnabdevanjaIIIstepen_26,
            style: style_ZatitavodavodosnabdevanjaIIIstepen_26_0,
        });
        bounds_group.addLayer(layer_ZatitavodavodosnabdevanjaIIIstepen_26);
        map.addLayer(layer_ZatitavodavodosnabdevanjaIIIstepen_26);
        function pop_Zatitazemljitaoderozije_27(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Zatitazemljitaoderozije_27_0() {
            return {
                pane: 'pane_Zatitazemljitaoderozije_27',
                opacity: 1,
                color: 'rgba(89,225,197,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(89,225,197,1.0)',
                fillPattern: typeof pattern_zatit_zemlja !== 'undefined' ? pattern_zatit_zemlja : null,
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Zatitazemljitaoderozije_27');
        map.getPane('pane_Zatitazemljitaoderozije_27').style.zIndex = 427;
        map.getPane('pane_Zatitazemljitaoderozije_27').style['mix-blend-mode'] = 'normal';
        var layer_Zatitazemljitaoderozije_27 = new L.geoJson(json_Zatitazemljitaoderozije_27, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Zatitazemljitaoderozije_27',
            layerName: 'layer_Zatitazemljitaoderozije_27',
            pane: 'pane_Zatitazemljitaoderozije_27',
            onEachFeature: pop_Zatitazemljitaoderozije_27,
            style: style_Zatitazemljitaoderozije_27_0,
        });
        bounds_group.addLayer(layer_Zatitazemljitaoderozije_27);
        map.addLayer(layer_Zatitazemljitaoderozije_27);

        var __srNaturalPointIndex = 1;
        var __srNaturalPointDescriptions = {
            1: 'Spomenik prirode Kovačevića pećina',
            2: 'Memorijalni prirodni spomenik Draginac',
            3: 'Spomenik prirode Debeli grm'
        };
        function pop_Zatienaprirodnadobra_take_28(feature, layer) {
            try {
                var props = feature && feature.properties ? feature.properties : (feature.properties = {});
                if (props.__srNaturalIndex == null) props.__srNaturalIndex = __srNaturalPointIndex++;
            } catch (e) {
                // ignore
            }

            layer.on({
                mouseover: function(e) {
                    try {
                        if (typeof layer.openPopup === 'function') layer.openPopup();
                    } catch (err) {
                        // ignore
                    }
                },
                mouseout: function(e) {
                    // Don't reset style for point markers - keep original appearance
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                // mouseover: highlightFeature,  // Disabled to prevent color change
            });

            var idxVal = null;
            try { idxVal = feature && feature.properties ? feature.properties.__srNaturalIndex : null; } catch (e) {}
            var desc = (idxVal != null && __srNaturalPointDescriptions[idxVal]) ? __srNaturalPointDescriptions[idxVal] : '';

            var popupContent = desc
                ? '<div>' + desc + '</div>'
                : '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';

            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Zatienaprirodnadobra_take_28_0() {
            return {
                pane: 'pane_Zatienaprirodnadobra_take_28',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(34,139,34,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(34,139,34,1.0)',
                interactive: true,
            }
        }
        // Single-style points (solid green circles)
        map.createPane('pane_Zatienaprirodnadobra_take_28');
        map.getPane('pane_Zatienaprirodnadobra_take_28').style.zIndex = 428;
        map.getPane('pane_Zatienaprirodnadobra_take_28').style['mix-blend-mode'] = 'normal';
        var layer_Zatienaprirodnadobra_take_28 = new L.geoJson(json_Zatienaprirodnadobra_take_28, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Zatienaprirodnadobra_take_28',
            layerName: 'layer_Zatienaprirodnadobra_take_28',
            pane: 'pane_Zatienaprirodnadobra_take_28',
            onEachFeature: pop_Zatienaprirodnadobra_take_28,
            pointToLayer: function (feature, latlng) {
                var __s0 = style_Zatienaprirodnadobra_take_28_0(feature);
                var __m0 = L.circleMarker(latlng, __s0);
                __m0._qgis2web_originalStyle = __s0;
                return __m0;
            },
        });
        bounds_group.addLayer(layer_Zatienaprirodnadobra_take_28);
        map.addLayer(layer_Zatienaprirodnadobra_take_28);
        function pop_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29_0() {
            return {
                pane: 'pane_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29',
                opacity: 1,
                color: 'rgba(4,116,78,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(231,113,72,0.0)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29');
        map.getPane('pane_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29').style.zIndex = 429;
        map.getPane('pane_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29').style['mix-blend-mode'] = 'normal';
        var layer_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29 = new L.geoJson(json_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29, {
            attribution: '',
            interactive: true,
            dataVar: 'json_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29',
            layerName: 'layer_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29',
            pane: 'pane_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29',
            onEachFeature: pop_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29,
            style: style_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29_0,
        });
        bounds_group.addLayer(layer_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29);
        map.addLayer(layer_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29);
        function pop_Podrujaupostupkuzatite_30(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['naziv'] !== null ? autolinker.link(feature.properties['naziv'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Podrujaupostupkuzatite_30_0() {
            return {
                pane: 'pane_Podrujaupostupkuzatite_30',
                opacity: 1,
                color: 'rgba(3,116,76,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(3,116,76,1.0)',
                fillPattern: typeof pattern_postupak !== 'undefined' ? pattern_postupak : null,
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Podrujaupostupkuzatite_30');
        map.getPane('pane_Podrujaupostupkuzatite_30').style.zIndex = 430;
        map.getPane('pane_Podrujaupostupkuzatite_30').style['mix-blend-mode'] = 'normal';
        var layer_Podrujaupostupkuzatite_30 = new L.geoJson(json_Podrujaupostupkuzatite_30, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Podrujaupostupkuzatite_30',
            layerName: 'layer_Podrujaupostupkuzatite_30',
            pane: 'pane_Podrujaupostupkuzatite_30',
            onEachFeature: pop_Podrujaupostupkuzatite_30,
            style: style_Podrujaupostupkuzatite_30_0,
        });
        bounds_group.addLayer(layer_Podrujaupostupkuzatite_30);
        map.addLayer(layer_Podrujaupostupkuzatite_30);
        function pop_Zatienaprirodnadobra_31(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<div>Memorijalni prirodni spomenik Tršić-Tronoša</div>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Zatienaprirodnadobra_31_0() {
            return {
                pane: 'pane_Zatienaprirodnadobra_31',
                opacity: 1,
                color: 'rgba(51,160,44,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0.3, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(114,155,111,0.7019607843137254)',
                className: 'poly-stroke-events',
                interactive: true,
            }
        }
        map.createPane('pane_Zatienaprirodnadobra_31');
        map.getPane('pane_Zatienaprirodnadobra_31').style.zIndex = 431;
        map.getPane('pane_Zatienaprirodnadobra_31').style['mix-blend-mode'] = 'normal';
        var layer_Zatienaprirodnadobra_31 = new L.geoJson(json_Zatienaprirodnadobra_31, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Zatienaprirodnadobra_31',
            layerName: 'layer_Zatienaprirodnadobra_31',
            pane: 'pane_Zatienaprirodnadobra_31',
            onEachFeature: pop_Zatienaprirodnadobra_31,
            style: style_Zatienaprirodnadobra_31_0,
        });
        bounds_group.addLayer(layer_Zatienaprirodnadobra_31);
        map.addLayer(layer_Zatienaprirodnadobra_31);
        function pop_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32_0() {
            return {
                pane: 'pane_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32',
                shape: 'square',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(255,255,255,0.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,84,0,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32');
        map.getPane('pane_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32').style.zIndex = 999;
        map.getPane('pane_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32').style['mix-blend-mode'] = 'normal';
        var layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32 = new L.geoJson(json_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32',
            layerName: 'layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32',
            pane: 'pane_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32',
            onEachFeature: pop_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.shapeMarker(latlng, style_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32_0(feature));
            },
        });
        bounds_group.addLayer(layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32);
        map.addLayer(layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32);
        function pop_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33_0() {
            return {
                pane: 'pane_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,83,0,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33');
        map.getPane('pane_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33').style.zIndex = 999;
        map.getPane('pane_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33').style['mix-blend-mode'] = 'normal';
        var layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33 = new L.geoJson(json_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33',
            layerName: 'layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33',
            pane: 'pane_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33',
            onEachFeature: pop_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33_0(feature));
            },
        });
        bounds_group.addLayer(layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33);
        map.addLayer(layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33);
        function pop_Spomenikkultureodvelikogznaaja_34(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Spomenikkultureodvelikogznaaja_34_0() {
            return {
                pane: 'pane_Spomenikkultureodvelikogznaaja_34',
                shape: 'square',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(255,127,0,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 8.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(0,0,0,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Spomenikkultureodvelikogznaaja_34');
        map.getPane('pane_Spomenikkultureodvelikogznaaja_34').style.zIndex = 999;
        map.getPane('pane_Spomenikkultureodvelikogznaaja_34').style['mix-blend-mode'] = 'normal';
        var layer_Spomenikkultureodvelikogznaaja_34 = new L.geoJson(json_Spomenikkultureodvelikogznaaja_34, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Spomenikkultureodvelikogznaaja_34',
            layerName: 'layer_Spomenikkultureodvelikogznaaja_34',
            pane: 'pane_Spomenikkultureodvelikogznaaja_34',
            onEachFeature: pop_Spomenikkultureodvelikogznaaja_34,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.shapeMarker(latlng, style_Spomenikkultureodvelikogznaaja_34_0(feature));
            },
        });
        bounds_group.addLayer(layer_Spomenikkultureodvelikogznaaja_34);
            function style_Pozajmitamaterijalaglina_16_0() {
          return {
            pane: 'pane_Pozajmitamaterijalaglina_16',
            opacity: 1,
            color: 'rgba(107,107,107,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 0.3,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(125,139,143,1.0)',
            className: 'poly-stroke-events',
            interactive: true,
          }
        }        function style_Pozajmitamaterijalaglina_16_0() {
          return {
            pane: 'pane_Pozajmitamaterijalaglina_16',
            opacity: 1,
            color: 'rgba(107,107,107,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 0.3,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(125,139,143,1.0)',
            className: 'poly-stroke-events',
            interactive: true,
          }
        }        function style_Pozajmitamaterijalaglina_16_0() {
          return {
            pane: 'pane_Pozajmitamaterijalaglina_16',
            opacity: 1,
            color: 'rgba(107,107,107,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(125,139,143,1.0)',
            className: 'poly-stroke-events',
            interactive: true,
          }
        }        function style_Pozajmitamaterijalaglina_16_0() {
          return {
            pane: 'pane_Pozajmitamaterijalaglina_16',
            opacity: 1,
            color: 'rgba(107,107,107,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 0.3,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(125,139,143,1.0)',
            className: 'poly-stroke-events',
            interactive: true,
          }
        }    map.addLayer(layer_Spomenikkultureodvelikogznaaja_34);
        var overlaysTree = [
        {label: '<b>Rudne aktivnosti</b>', selectAllCheckbox: true, children: [
            {label: '<img src="legend/Zatitazemljitaoderozije_27.png" /> Zaštita zemljišta od erozije', layer: layer_Zatitazemljitaoderozije_27},
            {label: '<img src="legend/ZatitavodavodosnabdevanjaIIIstepen_26.png" /> Zaštita voda (vodosnabdevanja) III stepen', layer: layer_ZatitavodavodosnabdevanjaIIIstepen_26},
            {label: '<img src="legend/Overenerezerve_25.png" /> Overene rezerve', layer: layer_Overenerezerve_25},
            {label: '<img src="legend/Aktivnaistranapolja_24.png" /> Aktivna istražna polja', layer: layer_Aktivnaistranapolja_24},
            {label: '<img src="legend/Istraivanjepodzemnihvoda_23.png" /> Istraživanje podzemnih voda', layer: layer_Istraivanjepodzemnihvoda_23},
            {label: '<img src="legend/Eksploatacionapolja_22.png" /> Eksploataciona polja', layer: layer_Eksploatacionapolja_22},
            {label: '<img src="legend/Podzonapristuparudniku_21.png" /> Podzona pristupa rudniku', layer: layer_Podzonapristuparudniku_21},
            {label: '<img src="legend/Podzonadeponije_20.png" /> Podzona deponije', layer: layer_Podzonadeponije_20},
            {label: '<img src="legend/Rudnotelo_19.png" /> Rudno telo', layer: layer_Rudnotelo_19},
            {label: '<img src="legend/Uticajnapovrinu_18.png" /> Uticaj na površinu', layer: layer_Uticajnapovrinu_18},
            {label: '<img src="legend/Podzonaproizvodnoindustrijskihaktivnosti_17.png" /> Podzona proizvodno-industrijskih aktivnosti', layer: layer_Podzonaproizvodnoindustrijskihaktivnosti_17},
            {label: '<img src="legend/Pozajmitamaterijalaglina_16.png" /> Pozajmišta materijala (glina)', layer: layer_Pozajmitamaterijalaglina_16},]},
        {label: '<b>Zaštita kulturnih dobara</b>', selectAllCheckbox: true, collapsed: true, children: [
            {label: '<img src="legend/Spomenikkultureodvelikogznaaja_34.png" /> Spomenik kulture od velikog značaja', layer: layer_Spomenikkultureodvelikogznaaja_34},
            {label: '<img src="legend/Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33.png" /> Zaštita kulturnih dobara - od interesa za zaštitu - arheološki lokalitet', layer: layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33},
            {label: '<img src="legend/Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32.png" /> Zaštita kulturnih dobara - od interesa za zaštitu - objekti graditeljskog nasleđa', layer: layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32},]},
        {label: '<b>Zaštita prirodnih dobara</b>', selectAllCheckbox: true, collapsed: true, children: [
            {label: '<img src="legend/Zatienaprirodnadobra_31.png" /> Zaštićena prirodna dobra', layer: layer_Zatienaprirodnadobra_31},
            {label: '<img src="legend/Podrujaupostupkuzatite_30.png" /> Područja u postupku zaštite', layer: layer_Podrujaupostupkuzatite_30},
            {label: '<img src="legend/EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29.png" /> Ekološki značajna područja - IBA - Orintološki značajno područje Cer', layer: layer_EkolokiznaajnapodrujaIBAOrintolokiznaajnopodrujeCer_29},
            {label: '<img src="legend/Zatienaprirodnadobra_take_28.png" /> Zaštićena prirodna dobra', layer: layer_Zatienaprirodnadobra_take_28},]},
        {label: '<b>Infrastruktura</b>', selectAllCheckbox: true, collapsed: true, children: [
            {label: '<img src="legend/Planiranostanjevodneinfrastrukture_15.png" /> Planirano stanje vodne infrastrukture', layer: layer_Planiranostanjevodneinfrastrukture_15},
            {label: '<img src="legend/Postojeestanjevodneinfrastrukture_14.png" /> Postojeće stanje vodne infrastrukture', layer: layer_Postojeestanjevodneinfrastrukture_14},
            {label: '<img src="legend/Planiranostanjegasnihobjekata_13.png" /> Planirano stanje gasnih objekata', layer: layer_Planiranostanjegasnihobjekata_13},
            {label: '<img src="legend/Planiranostanjeelektroenergetskihobjekata_12.png" /> Planirano stanje elektroenergetskih objekata', layer: layer_Planiranostanjeelektroenergetskihobjekata_12},
            {label: '<img src="legend/Postojeestanjeelektroenergetskihobjekata_11.png" /> Postojeće stanje elektroenergetskih objekata', layer: layer_Postojeestanjeelektroenergetskihobjekata_11},
            {label: 'Planirano stanje gasne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Planiranostanjegasneinfrastrukture_10_Gasovod0.png" /></td><td>Gasovod</td></tr></table>', layer: layer_Planiranostanjegasneinfrastrukture_10},
            {label: 'Postojeće stanje gasne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Postojeestanjegasneinfrastrukture_9_Magistralnigasovod0.png" /></td><td>Magistralni gasovod</td></tr></table>', layer: layer_Postojeestanjegasneinfrastrukture_9},
            {label: 'Planirano stanje elektroenergetske infrastukture<br /><table><tr><td style="text-align: center;"><img src="legend/Planiranostanjeelektroenergetskeinfrastukture_8_Dalekovod10kV0.png" /></td><td>Dalekovod 10 kV</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjeelektroenergetskeinfrastukture_8_Dalekovod110kV1.png" /></td><td>Dalekovod 110 kV</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjeelektroenergetskeinfrastukture_8_Dalekovod35kV2.png" /></td><td>Dalekovod 35 kV</td></tr></table>', layer: layer_Planiranostanjeelektroenergetskeinfrastukture_8},
            {label: 'Postojeće stanje elektroenergetske infrastukture<br /><table><tr><td style="text-align: center;"><img src="legend/Postojeestanjeelektroenergetskeinfrastukture_7_Dalekovod110kV0.png" /></td><td>Dalekovod 110 kV</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjeelektroenergetskeinfrastukture_7_Dalekovod220kV1.png" /></td><td>Dalekovod 220 kV</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjeelektroenergetskeinfrastukture_7_Dalekovod35kV2.png" /></td><td>Dalekovod 35 kV</td></tr></table>', layer: layer_Postojeestanjeelektroenergetskeinfrastukture_7},
            {label: 'Planirano stanje vodne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Planiranostanjevodneinfrastrukture_6_Cevovodotpadnevode0.png" /></td><td>Cevovod otpadne vode</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjevodneinfrastrukture_6_Cevovodtehničkevode1.png" /></td><td>Cevovod tehničke vode</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjevodneinfrastrukture_6_Fekalnakanalizacija2.png" /></td><td>Fekalna kanalizacija</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjevodneinfrastrukture_6_Primarnavodovodnamreža3.png" /></td><td>Primarna vodovodna mreža</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjevodneinfrastrukture_6_Regionalnikanalizacionikolektori4.png" /></td><td>Regionalni kanalizacioni kolektori</td></tr></table>', layer: layer_Planiranostanjevodneinfrastrukture_6},
            {label: 'Postojeće stanje vodne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Postojeestanjevodneinfrastrukture_5_Primarnavodovodnamreža0.png" /></td><td>Primarna vodovodna mreža</td></tr></table>', layer: layer_Postojeestanjevodneinfrastrukture_5},
            {label: 'Planirano stanje saobraćajne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_DržavniputIbreda0.png" /></td><td>Državni put Ib reda</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_Lokalniput1.png" /></td><td>Lokalni put</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_ObilaznicaokoLoznice2.png" /></td><td>Obilaznica oko Loznice</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_PrugaValjevoLoznica4.png" /></td><td>Pruga Valjevo-Loznica</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_PrugaServisna5.png" /></td><td>Pruga-Servisna</td></tr><tr><td style="text-align: center;"><img src="legend/Planiranostanjesaobraajneinfrastrukture_4_Saobraćajnice6.png" /></td><td>Saobraćajnice</td></tr></table>', layer: layer_Planiranostanjesaobraajneinfrastrukture_4},
            {label: 'Postojeće stanje saobraćajne infrastrukture<br /><table><tr><td style="text-align: center;"><img src="legend/Postojeestanjesaobraajneinfrastrukture_3_DržavniputIbreda0.png" /></td><td>Državni put Ib reda</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjesaobraajneinfrastrukture_3_DržavniputIIareda1.png" /></td><td>Državni put IIa reda</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjesaobraajneinfrastrukture_3_DržavniputIIbreda2.png" /></td><td>Državni put IIb reda</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjesaobraajneinfrastrukture_3_Lokalniput3.png" /></td><td>Lokalni put</td></tr><tr><td style="text-align: center;"><img src="legend/Postojeestanjesaobraajneinfrastrukture_3_PrugaŠabacLoznica4.png" /></td><td>Pruga Šabac-Loznica</td></tr></table>', layer: layer_Postojeestanjesaobraajneinfrastrukture_3},]},
            {label: '<img src="legend/Granicaplana_2.png" /> Granica plana', layer: layer_Granicaplana_2},
            {label: '<img src="legend/Katastarskeoptine_1.png" /> Katastarske opštine', layer: layer_Katastarskeoptine_1},
        ]

        // Put basemaps at the bottom of the legend (as a final group)
        overlaysTree.push({
            label: '<b>Podloge</b>',
            selectAllCheckbox: false,
            collapsed: false,
            children: [
                {label: "CartoDb Positron", layer: layer_CartoDbPositron_0, radioGroup: 'bm'},
                {label: "OpenStreetMap", layer: layer_OpenStreetMap_1, radioGroup: 'bm'},
                {label: "OpenTopoMap", layer: layer_OpenTopoMap_3, radioGroup: 'bm'},
                {label: "Satellite (Esri)", layer: layer_EsriWorldImagery_2, radioGroup: 'bm'}
            ]
        });

        // Add simple numeric labels (1..N) to all features in the
        // 'Zaštita kulturnih dobara' group to help partners reference them.
        (function () {
            var __srCulturalDescriptions = {
                1: "Bare, arheološki lokalitet, nekropola sa humkama, bronzano doba",
                2: "Crkvena porta u Dragincu, arheološki lokalitet, nekropola sa tumulima, gvozdeno doba",
                3: "Kulina, arheološki lokalitet, gradinsko naselje, eneolit, vinčanska kultura",
                4: "Atice, arheološki lokalitet, nekropola sa tumulima, bronzano doba",
                5: "Cikotski gradac, arheološki lokalitet, gradinsko naselje, bronzano doba",
                6: "Mađarsko groblje u selu Cikote 1, arheološki lokalitet, groblje, 16–19. vek",
                7: "Šurički gradac, arheološki lokalitet, ostaci fortifikacije, rimski period",
                8: "Crkvine, arheološki lokalitet, ostaci srednjovekovne crkve",
                9: "Mađarsko groblje u selu Šurice, arheološki lokalitet, staro groblje, 16–19. vek, otomanski period",
                10: "Džamija, arheološki lokalitet, neopredeljeni nalazi, srednji vek",
                11: "Čardačine, arheološki lokalitet, neopredeljeni nalazi, srednji vek",
                12: "Paulje, arheološki lokalitet, nekropola sa tumulima, bronzano doba",
                13: "Groblje u selu G. Nedeljice, arheološki lokalitet, nekropola sa tumulima, bronzano i gvozdeno doba",
                14: "Crkvina, arheološki lokalitet, gradinsko naselje, neolit, vinčanska kultura",
                15: "Nedeljice – Grnčara, arheološki lokalitet, naselje, otomanski period",
                16: "Kućerine, arheološki lokalitet, naselje, neolit, vinčanska kultura",
                17: "Panjik, arheološki lokalitet, naselje, otomanski period",
                18: "Mramorje, arheološki lokalitet, groblje, 16–19. vek",
                19: "Lokalitet Prljevska crkva u blizini crkve u Lipnici, arheološki lokalitet, neolit, vinčanska kultura",
                21: "Krivajevica 2, arheološki lokalitet, nekropola sa tumulima, bronzano i gvozdeno doba",
                22: "Krivajevica 3, arheološki lokalitet, naselje, srednji vek",
                23: "Kućerine, arheološki lokalitet, fortifikacija – šanac, otomanski period",
                24: "Grnčara, arheološki lokalitet, naselje, otomanski period",
                25: "Krivajevica, arheološki lokalitet, nekropola sa tumulima, bronzano i gvozdeno doba<br/>Mađarsko groblje, Brnjac 1, arheološki lokalitet, groblje, 16–19. vek, otomanski period",
                26: "Mađarsko groblje, Brnjac 2, arheološki lokalitet, groblje, 16–19. vek, otomanski period",
                27: "Mađarsko groblje – Brnjac 3, arheološki lokalitet, 16–19. vek",
                28: "Carev grm, arheološki lokalitet, nekropola sa tumulima, bronzano doba",
                29: "Vidojevica, arheološki lokalitet, neolitsko naselje",
                30: "Vranjsko polje, arheološki lokalitet, naselje, rimski period, 4. vek",
                31: "Konak, arheološki lokalitet, naselje, srednji vek – otomanski period",
                32: "Velika gradina, arheološki lokalitet, rimski period, pozna antika",
                33: "Groblje u Radićima, arheološki lokalitet, srednjovekovno groblje",
                34: "Jovića brdo, arheološki lokalitet, srednjovekovno groblje",
                35: "Mađarsko groblje u Dvorskoj, arheološki lokalitet, srednjovekovno groblje",
                36: "Glavica, arheološki lokalitet, neolitsko naselje, vinčanska kultura",
                37: "Mađarsko groblje u selu Cikote 2, arheološki lokalitet, srednjovekovno groblje",
                38: "Kuća Miloša Nestorovića, graditeljsko nasleđe, narodna arhitektura",
                39: "Crkva u selu Dvorska, graditeljsko nasleđe, sakralna arhitektura",
                40: "Kuća Milenka Vukašinovića, graditeljsko nasleđe, narodna arhitektura",
                41: "Kuća Slavoljuba Tanasića",
                42: "Bunar Obrada Marića",
                43: "Kuća Zlaje Teofilovića",
                44: "Kuća Živka Matića, graditeljsko nasleđe, narodna arhitektura",
                45: "Kuća Zorana Grujića, graditeljsko nasleđe, narodna arhitektura",
                46: "Crkva u Dragincu, graditeljsko nasleđe, sakralna arhitektura",
                47: "Spomenik i spomen-kosturnica streljanim žrtvama u Dragincu",
                48: "Stara školska zgrada u Dragincu, graditeljsko nasleđe, gradska arhitektura",
                49: "Crkva – spomen-kosturnica u selu Korenita (Brezjak), sakralna arhitektura",
                50: "Manastir Tronoša, graditeljsko nasleđe, sakralna arhitektura",
                51: "Crkva u selu G. Nedeljice, graditeljsko nasleđe, sakralna arhitektura",
                52: "Zgrada osnovne škole u selu Donje Nedeljice, graditeljsko nasleđe, gradska arhitektura",
                53: "Crkva (Preobraženja Gospodnjeg) u selu Lipnica, sakralna arhitektura"
            };

            function getCulturalDescription(idx) {
                return __srCulturalDescriptions[idx] || '';
            }

            function bindDescriptionsByIndex(geoJsonLayer, startIndex) {
                var nextIndex = startIndex;
                if (!geoJsonLayer || typeof geoJsonLayer.eachLayer !== 'function') return nextIndex;

                geoJsonLayer.eachLayer(function (featureLayer) {
                    if (!featureLayer || !featureLayer.feature) return;
                    var props = featureLayer.feature.properties || (featureLayer.feature.properties = {});

                    if (props.__srCulturalIndex == null) {
                        props.__srCulturalIndex = nextIndex++;
                    }

                    // Show description on hover (the project already opens popups on hover for these layers)
                    var desc = getCulturalDescription(props.__srCulturalIndex);
                    if (desc) {
                        var popupHtml = '<div>' + desc + '</div>';
                        featureLayer.bindPopup(popupHtml, { maxHeight: 400 });
                    }
                });

                return nextIndex;
            }

            var idx = 1;
            // Start with archaeological sites (matches the provided 1..37 list)
            idx = bindDescriptionsByIndex(layer_Zatitakulturnihdobaraodinteresazazatituarheolokilokalitet_33, idx);
            idx = bindDescriptionsByIndex(layer_Zatitakulturnihdobaraodinteresazazatituobjektigraditeljskognaslea_32, idx);
            idx = bindDescriptionsByIndex(layer_Spomenikkultureodvelikogznaaja_34, idx);
        })();

        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: false, 
        });
        lay.addTo(map);
        // Add map title and legend title to the legend box
        setTimeout(function() {
            var legendContainer = document.querySelector('.leaflet-control-layers-list');
            if (!legendContainer) return;

            var legendTitle = legendContainer.querySelector('.legend-title');
            if (!legendTitle) {
                legendTitle = document.createElement('div');
                legendTitle.className = 'legend-title';
                legendTitle.textContent = 'Legenda';
                legendContainer.insertBefore(legendTitle, legendContainer.firstChild);
            }

            var mapTitle = legendContainer.querySelector('.legend-map-title');
            if (!mapTitle) {
                mapTitle = document.createElement('div');
                mapTitle.className = 'legend-map-title';
                legendContainer.insertBefore(mapTitle, legendTitle);
            }

            var mapTitleText = mapTitle.querySelector('.legend-map-title-text');
            if (!mapTitleText) {
                mapTitleText = document.createElement('div');
                mapTitleText.className = 'legend-map-title-text';
                mapTitle.appendChild(mapTitleText);
            }
            mapTitleText.textContent = 'Sintezna mapa\nProstornog plana za Jadar';

            var infoToggle = mapTitle.querySelector('.legend-info-toggle');
            if (!infoToggle) {
                infoToggle = document.createElement('button');
                infoToggle.type = 'button';
                infoToggle.className = 'legend-info-toggle';
                infoToggle.setAttribute('aria-label', 'Informacije o mapi');
                infoToggle.setAttribute('aria-expanded', 'false');
                infoToggle.setAttribute('aria-controls', 'legend-info-panel');
                infoToggle.title = 'Info';
                infoToggle.textContent = 'i';
                mapTitle.appendChild(infoToggle);
            }

            var infoPanel = legendContainer.querySelector('#legend-info-panel');
            if (!infoPanel) {
                infoPanel = document.createElement('div');
                infoPanel.id = 'legend-info-panel';
                infoPanel.className = 'legend-info-panel';
                infoPanel.hidden = true;
                infoPanel.innerHTML = 'Ova interaktivna mapa objedinjuje referalne karte iz <a href="https://www.mgsi.gov.rs/lat/dokumenti/javni-uvid-u-nacrt-prostornog-plana-podrucja-posebne-namene-za-realizaciju-projekta" target="_blank" rel="noopener noreferrer">Nacrta prostornog plana područja posebne namene za projekat Jadar</a> i omogućava pregled ključnih prostornih, infrastrukturnih i planskih rešenja.';
                legendContainer.insertBefore(infoPanel, legendTitle);
            }

            // Per-layer opacity sliders placed directly under the four mining-related layers
            function ensureOpacitySliderForLayer(layerObj, styleFn, opacityKey) {
                try {
                    if (!layerObj || typeof layerObj.setStyle !== 'function') return;
                    if (typeof L === 'undefined' || typeof L.stamp !== 'function') return;
                    var layerId = L.stamp(layerObj);
                    var inputs = legendContainer.querySelectorAll('input.leaflet-control-layers-selector');
                    var inputEl = null;
                    for (var i = 0; i < inputs.length; i++) {
                        if (inputs[i] && inputs[i].layerId === layerId) {
                            inputEl = inputs[i];
                            break;
                        }
                    }
                    if (!inputEl) return;
                    var labelEl = inputEl.closest('label') || inputEl.parentElement;
                    if (!labelEl || !labelEl.parentNode) return;
                    if (legendContainer.querySelector('[data-opacity-for-layer-id="' + layerId + '"]')) return;

                    var wrap = document.createElement('div');
                    wrap.className = 'legend-layer-opacity';
                    wrap.setAttribute('data-opacity-for-layer-id', String(layerId));

                    var row = document.createElement('div');
                    row.className = 'legend-layer-opacity-row';

                    var valueEl = document.createElement('div');
                    valueEl.className = 'legend-layer-opacity-value';

                    var slider = document.createElement('input');
                    slider.type = 'range';
                    slider.min = '0';
                    slider.max = '100';
                    slider.step = '1';

                    var startPct = Math.round(__getLayerOpacity(opacityKey, 0.5) * 100);
                    if (!isFinite(startPct)) startPct = 50;
                    slider.value = String(startPct);
                    valueEl.textContent = startPct + '%';

                    row.appendChild(valueEl);
                    wrap.appendChild(row);
                    wrap.appendChild(slider);

                    labelEl.parentNode.insertBefore(wrap, labelEl.nextSibling);

                    if (typeof L !== 'undefined' && L.DomEvent) {
                        L.DomEvent.disableClickPropagation(wrap);
                        L.DomEvent.disableScrollPropagation(wrap);
                    }

                    function applyOpacityFromSlider() {
                        var pct = parseInt(slider.value, 10);
                        if (!isFinite(pct)) pct = 50;
                        valueEl.textContent = pct + '%';
                        __layerOpacity[opacityKey] = pct / 100;
                        try { layerObj.setStyle(styleFn); } catch (err) {}
                    }

                    slider.addEventListener('input', applyOpacityFromSlider);
                    slider.addEventListener('change', applyOpacityFromSlider);
                    applyOpacityFromSlider();
                } catch (e) {
                    // ignore
                }
            }

            function ensureAllOpacitySliders() {
                ensureOpacitySliderForLayer(
                    (typeof layer_Podzonadeponije_20 !== 'undefined' ? layer_Podzonadeponije_20 : null),
                    (typeof style_Podzonadeponije_20_0 !== 'undefined' ? style_Podzonadeponije_20_0 : null),
                    'Podzonadeponije_20'
                );
                ensureOpacitySliderForLayer(
                    (typeof layer_Rudnotelo_19 !== 'undefined' ? layer_Rudnotelo_19 : null),
                    (typeof style_Rudnotelo_19_0 !== 'undefined' ? style_Rudnotelo_19_0 : null),
                    'Rudnotelo_19'
                );
                ensureOpacitySliderForLayer(
                    (typeof layer_Uticajnapovrinu_18 !== 'undefined' ? layer_Uticajnapovrinu_18 : null),
                    (typeof style_Uticajnapovrinu_18_0 !== 'undefined' ? style_Uticajnapovrinu_18_0 : null),
                    'Uticajnapovrinu_18'
                );
                ensureOpacitySliderForLayer(
                    (typeof layer_Podzonapristuparudniku_21 !== 'undefined' ? layer_Podzonapristuparudniku_21 : null),
                    (typeof style_Podzonapristuparudniku_21_0 !== 'undefined' ? style_Podzonapristuparudniku_21_0 : null),
                    'Podzonapristuparudniku_21'
                );
                ensureOpacitySliderForLayer(
                    (typeof layer_Podzonaproizvodnoindustrijskihaktivnosti_17 !== 'undefined' ? layer_Podzonaproizvodnoindustrijskihaktivnosti_17 : null),
                    (typeof style_Podzonaproizvodnoindustrijskihaktivnosti_17_0 !== 'undefined' ? style_Podzonaproizvodnoindustrijskihaktivnosti_17_0 : null),
                    'Podzonaproizvodnoindustrijskihaktivnosti_17'
                );
            }

            ensureAllOpacitySliders();

            if (!legendContainer.dataset.opacitySlidersBound) {
                legendContainer.dataset.opacitySlidersBound = '1';
                var _opacitySlidersTimer = null;
                var _opacitySlidersObserver = new MutationObserver(function() {
                    if (_opacitySlidersTimer) clearTimeout(_opacitySlidersTimer);
                    _opacitySlidersTimer = setTimeout(ensureAllOpacitySliders, 50);
                });
                try {
                    _opacitySlidersObserver.observe(legendContainer, { childList: true, subtree: true });
                } catch (e) {
                    // ignore
                }
            }

            if (!infoToggle.dataset.bound) {
                infoToggle.dataset.bound = '1';
                infoToggle.addEventListener('click', function(ev) {
                    ev.preventDefault();
                    ev.stopPropagation();
                    var controlEl = legendContainer.closest('.leaflet-control-layers');
                    var willOpen = infoPanel.hidden;

                    // Prevent horizontal expansion: lock current width while info is open.
                    if (controlEl) {
                        if (willOpen) {
                            var w = controlEl.getBoundingClientRect().width;
                            controlEl.style.width = Math.round(w) + 'px';
                        } else {
                            controlEl.style.width = '';
                        }
                    }

                    infoPanel.hidden = !willOpen;
                    infoToggle.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
                    mapTitle.classList.toggle('legend-info-open', willOpen);
                });
            }
        }, 100);
		// Build a lookup of legend labels by the leaflet layer id so we can use it as a popup fallback
		function buildLegendLabelsMap() {
			_legendLabelsById = {};
			function walk(items) {
				for (var i = 0; i < items.length; i++) {
					var it = items[i];
					if (it.layer) {
						try {
							var temp = document.createElement('div');
							temp.innerHTML = it.label || '';
							var text = temp.textContent.trim();
							if (text && it.layer && it.layer._leaflet_id !== undefined) {
								_legendLabelsById[it.layer._leaflet_id] = text;
							}
						} catch (err) {
							// ignore
						}
					}
					if (it.children) walk(it.children);
				}
			}
			walk(overlaysTree);
		}
		buildLegendLabelsMap();
		map.on('layeradd', buildLegendLabelsMap);
		document.addEventListener("DOMContentLoaded", function() {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height 
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
			// apply new Layers List height if toggle layerstree
			if (controlLayersElement) {
				controlLayersElement.addEventListener('click', function(event) {
					var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
					if (toggleLayerHeaderPointer) {
						newLayersListHeight();
					}
				});
			}
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }

            // Default legend visibility settings (user preference)
            setTimeout(function() {
                try {
                    // helper: set checkbox state by visible label text inside the control
                    function setControlCheckboxByText(text, checked) {
                        var labels = document.querySelectorAll('.leaflet-control-layers-list label, .leaflet-control-layers-list span, .leaflet-control-layers-list div');
                        for (var i = 0; i < labels.length; i++) {
                            var lab = labels[i];
                            if (!lab || !lab.textContent) continue;
                            if (lab.textContent.trim().indexOf(text) !== -1) {
                                // try to find an input element associated with this label
                                var inp = lab.querySelector('input') || lab.previousElementSibling || lab.parentNode && lab.parentNode.querySelector('input[type="checkbox"], input[type="radio"]');
                                if (inp && (inp.type === 'checkbox' || inp.type === 'radio')) {
                                    try {
                                        if (inp.checked !== checked) {
                                            inp.checked = checked;
                                            // dispatch change so control updates internal state
                                            inp.dispatchEvent(new Event('change', { bubbles: true }));
                                        }
                                    } catch (err) { /* ignore */ }
                                }
                            }
                        }
                    }

                    // Robust default visibility: explicitly set only these layers ON, all others OFF
                    var allowed = {};
                    function addLayerToAllowed(l) { try { if (l && l._leaflet_id !== undefined) allowed[l._leaflet_id] = true; } catch (err) {} }
                    // Always-on base layers / explicit layers
                    addLayerToAllowed(layer_Rudnotelo_19);
                    addLayerToAllowed(layer_Granicaplana_2);
                    addLayerToAllowed(layer_Katastarskeoptine_1);
                    addLayerToAllowed(layer_CartoDbPositron_0);

                    // Also include every layer listed under the 'Rudne aktivnosti' group in overlaysTree
                    function includeGroupChildren(items, groupName) {
                        for (var i = 0; i < items.length; i++) {
                            var it = items[i];
                            try {
                                var temp = document.createElement('div'); temp.innerHTML = it.label || '';
                                var text = temp.textContent.trim();
                                if (text.indexOf(groupName) !== -1 && it.children && it.children.length) {
                                    for (var j = 0; j < it.children.length; j++) {
                                        try {
                                            var child = it.children[j];
                                            if (child && child.layer && child.layer._leaflet_id !== undefined) {
                                                allowed[child.layer._leaflet_id] = true;
                                            }
                                        } catch (err) { /* ignore child */ }
                                    }
                                    return true; // found and processed
                                }
                                if (it.children) {
                                    if (includeGroupChildren(it.children, groupName)) return true;
                                }
                            } catch (err) {
                                // ignore
                            }
                        }
                        return false;
                    }
                    includeGroupChildren(overlaysTree, 'Rudne aktivnosti');
                    // Ensure group header checkbox is marked ON as well
                    setControlCheckboxByText('Rudne aktivnosti', true);

                    // Helper: find a named group and disable all its children (checkbox + map layer)
                    function disableGroupChildren(items, groupName) {
                        for (var i = 0; i < items.length; i++) {
                            var it = items[i];
                            try {
                                var temp = document.createElement('div'); temp.innerHTML = it.label || '';
                                var text = temp.textContent.trim();
                                if (text.indexOf(groupName) !== -1 && it.children && it.children.length) {
                                    // uncheck group header
                                    setControlCheckboxByText(groupName, false);
                                    for (var j = 0; j < it.children.length; j++) {
                                        try {
                                            var child = it.children[j];
                                            var temp2 = document.createElement('div'); temp2.innerHTML = child.label || '';
                                            var childText = temp2.textContent.trim();
                                            // sync checkbox for child and remove layer from map
                                            setControlCheckboxByText(childText, false);
                                            if (child && child.layer) { try { if (map.hasLayer(child.layer)) map.removeLayer(child.layer); } catch (err) {} }
                                            console.log('Default visibility (force off group): ' + childText + ' -> OFF');
                                        } catch (err) { /* ignore child */ }
                                    }
                                    return true; // found and processed
                                }
                                if (it.children) {
                                    if (disableGroupChildren(it.children, groupName)) return true;
                                }
                            } catch (err) {
                                // ignore
                            }
                        }
                        return false;
                    }

                    // Ensure the whole 'Zaštita kulturnih dobara' group is turned OFF
                    disableGroupChildren(overlaysTree, 'Zaštita kulturnih dobara');

                    // Diagnostics: list all control labels and their input elements so we can debug mismatches
                    function logLayerControlDiagnostics(groupName) {
                        try {
                            console.group('Layer control diagnostics');
                            var labels = document.querySelectorAll('.leaflet-control-layers-list label, .leaflet-control-layers-list span, .leaflet-control-layers-list div');
                            console.log('Found ' + labels.length + ' label elements in control.');
                            for (var i = 0; i < labels.length; i++) {
                                var lab = labels[i];
                                var txt = lab.textContent ? lab.textContent.trim() : '';
                                var inp = lab.querySelector('input') || lab.previousElementSibling || (lab.parentNode && lab.parentNode.querySelector('input[type="checkbox"], input[type="radio"]'));
                                var inpDesc = 'NO INPUT';
                                try {
                                    if (inp) inpDesc = inp.tagName + ' type=' + (inp.type||'') + ' checked=' + (!!inp.checked) + ' disabled=' + (!!inp.disabled);
                                } catch (err) { inpDesc = 'INPUT ACCESS ERROR'; }
                                console.log(i + ': "' + txt + '" -> ' + inpDesc);
                                if (groupName && txt.indexOf(groupName) !== -1) {
                                    console.log('Matched group label for "' + groupName + '": element index ' + i);
                                }
                            }

                            // Also dump overlaysTree labels and layer ids to correlate
                            function walk(items, depth) {
                                for (var j = 0; j < items.length; j++) {
                                    var it = items[j];
                                    var temp = document.createElement('div'); temp.innerHTML = it.label || '';
                                    var text = temp.textContent.trim();
                                    if (it.layer && it.layer._leaflet_id !== undefined) {
                                        console.log('overlaysTree: ' + new Array(depth+1).join('  ') + text + ' -> layer id ' + it.layer._leaflet_id);
                                    } else if (it.label) {
                                        console.log('overlaysTree: ' + new Array(depth+1).join('  ') + text);
                                    }
                                    if (it.children) walk(it.children, depth+1);
                                }
                            }
                            walk(overlaysTree, 0);
                            console.groupEnd();
                        } catch (err) {
                            try { console.error('Layer control diagnostics failed', err); } catch (e) {}
                        }
                    }

                    // Run diagnostics to aid debugging
                    setTimeout(function(){ logLayerControlDiagnostics('Zaštita kulturnih dobara'); }, 200);

                    // Walk overlaysTree and set visibility + sync checkboxes
                    function walkAndApply(items) {
                        for (var i = 0; i < items.length; i++) {
                            var it = items[i];
                            if (it.layer) {
                                try {
                                    var temp = document.createElement('div'); temp.innerHTML = it.label || '';
                                    var text = temp.textContent.trim();
                                    var layer = it.layer;
                                    var shouldBeOn = !!allowed[layer._leaflet_id];

                                    // sync control checkbox for this label
                                    setControlCheckboxByText(text, shouldBeOn);

                                    // apply map visibility
                                    if (shouldBeOn) {
                                        if (!map.hasLayer(layer)) map.addLayer(layer);
                                    } else {
                                        if (map.hasLayer(layer)) map.removeLayer(layer);
                                    }

                                    console.log('Default visibility: ' + text + ' -> ' + (shouldBeOn ? 'ON' : 'OFF'));
                                } catch (err) {
                                    // ignore
                                }
                            }
                            if (it.children) walkAndApply(it.children);
                        }
                    }
                    walkAndApply(overlaysTree);

                    // Ensure basemap is ON
                    try { if (!map.hasLayer(layer_CartoDbPositron_0)) map.addLayer(layer_CartoDbPositron_0); setControlCheckboxByText('CartoDb Positron', true); } catch (err) {}

                } catch (err) {
                    // ignore
                }
            }, 150);
        });       
        // setBounds();
        </script>

        <!-- Map by Antonije Ćatić and Branko Milošević -->
    </body>
</html>
